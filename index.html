<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§ - Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- IMPROVED CLASH THEME WITH PROFESSIONAL ENHANCEMENTS --- */
        :root {
            --clash-blue-dark: #2c4a7a;
            --clash-blue-light: #4a78b8;
            --clash-gold: #ffd700;
            --clash-gold-dark: #d4af37;
            --clash-brown-dark: #4a2f20;
            --clash-text-light: #f5f5f5;
            --clash-text-dark: #1e1e1e;
            --clash-green: #4caf50;
            --clash-green-dark: #388e3c;
            --clash-red: #f44336;
            --clash-red-dark: #d32f2f;
            --clash-panel-bg: #3a5b8a;
            --clash-panel-border: #7da8e8;
            --clash-panel-border-dark: #1e3a5e;
        }

        /* --- ADVANCED ANIMATIONS --- */
        @keyframes clash-panel-intro {
            0% { opacity: 0; transform: scale(0.95) translateY(-20px); }
            60% { opacity: 1; transform: scale(1.02) translateY(0); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        @keyframes breathe-glow {
            0%, 100% { transform: scale(1); box-shadow: 0 6px 12px rgba(255, 215, 0, 0.3); }
            50% { transform: scale(1.03); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.6); }
        }

        @keyframes background-drift {
            0% { background-position: 0% 0%; }
            100% { background-position: 150% 150%; }
        }

        @keyframes spin-smooth {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInBounce {
            0% { opacity: 0; transform: translateY(-50px); }
            60% { opacity: 1; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-shadow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
        }

        @keyframes tip-slide-in {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* --- IMPROVED MIND GAME ANIMATIONS --- */
        @keyframes fall-smooth-fade {
            0% { transform: translateY(-150%); opacity: 0; }
            20% { transform: translateY(0); opacity: 1; }
            80% { transform: translateY(120px); opacity: 1; }
            100% { transform: translateY(180px); opacity: 0; }
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            color: var(--clash-text-light);
            background-color: #162447;
            background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
            overflow: hidden;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            position: relative;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 300%; height: 300%;
            background-image: url('https://www.transparenttextures.com/patterns/noise.png');
            opacity: 0.1;
            z-index: -1;
            animation: background-drift 180s linear infinite;
        }

        .clash-font {
            font-family: 'Lilita One', cursive;
            letter-spacing: 1.5px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .panel-clash {
            background-color: var(--clash-panel-bg);
            border: 5px solid var(--clash-panel-border-dark);
            border-top-color: var(--clash-panel-border);
            border-left-color: var(--clash-panel-border);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 3px 6px rgba(255, 255, 255, 0.15);
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            position: relative;
        }

        .panel-clash::before, .panel-clash::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--clash-gold);
            border-radius: 50%;
            border: 3px solid var(--clash-brown-dark);
            box-shadow: 0 0 5px #000;
        }
        .panel-clash::before { top: 12px; left: 12px; }
        .panel-clash::after { top: 12px; right: 12px; }

        .panel-hidden {
            opacity: 0;
            transform: scale(0.95) translateY(-30px);
            pointer-events: none;
            visibility: hidden;
        }

        .panel-visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            visibility: visible;
            animation: clash-panel-intro 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .btn-clash {
            border-radius: 16px;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.2s ease-out;
            cursor: pointer;
            position: relative;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--clash-text-dark);
            text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        .btn-clash:disabled {
            filter: grayscale(90%);
            cursor: not-allowed;
            box-shadow: 0 5px 0 #444 !important;
            transform: translateY(0) !important;
        }

        .btn-clash-primary {
            background: linear-gradient(to bottom, #ffeb99, var(--clash-gold));
            border: 3px solid var(--clash-brown-dark);
            box-shadow: 0 8px 0 #b8860b;
            padding: 12px 28px;
            font-size: 1.2rem;
        }
        @media (min-width: 640px) { .btn-clash-primary { padding: 14px 36px; font-size: 1.4rem; } }

        .btn-clash-primary:hover {
            background: linear-gradient(to bottom, #fff5cc, #ffcc00);
            transform: translateY(-3px);
            box-shadow: 0 11px 0 #b8860b;
        }
        .btn-clash-primary:active {
            transform: translateY(5px) !important;
            box-shadow: 0 3px 0 #b8860b !important;
            transition-duration: 0.1s;
        }

        #start-game-btn.breathing {
            animation: breathe-glow 3s ease-in-out infinite;
        }

        .btn-clash-secondary {
            background: linear-gradient(to bottom, #8ab6f2, var(--clash-blue-light));
            border: 3px solid var(--clash-panel-border-dark);
            box-shadow: 0 6px 0 #1e3a5e;
            padding: 10px 20px;
            font-size: 1rem;
            color: var(--clash-text-light);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        @media (min-width: 640px) { .btn-clash-secondary { padding: 12px 24px; font-size: 1.1rem; } }

        .btn-clash-secondary:hover {
            background: linear-gradient(to bottom, #a8c9ff, #7a98d8);
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #1e3a5e;
        }
        .btn-clash-secondary:active {
            transform: translateY(4px) !important;
            box-shadow: 0 2px 0 #1e3a5e !important;
            transition-duration: 0.1s;
        }

        .input-clash {
            background-color: var(--clash-panel-border-dark);
            border: 3px solid #1e3a5e;
            color: #fff;
            border-radius: 12px;
            padding: 14px;
            font-size: 1.1rem;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.5);
            -webkit-user-select: auto;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: auto;
            touch-action: manipulation;
        }
        .input-clash:focus {
            outline: none;
            border-color: var(--clash-gold);
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.5), 0 0 12px var(--clash-gold);
        }
        .input-clash.invalid {
            border-color: var(--clash-red);
        }
        .input-clash:read-only {
            background-color: #2a4a70;
            cursor: default;
        }

        .option-btn {
            background: linear-gradient(to bottom, #8ab6f2, #4a78b8);
            border: 3px solid #1e3a5e;
            box-shadow: 0 5px 0 #1e3a5e;
            color: white;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            padding: 14px;
            border-radius: 16px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
        }
        .option-btn:hover:not(:disabled) {
            background: linear-gradient(to bottom, #a8c9ff, #6a88c8);
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #1e3a5e;
        }
        .option-btn.correct {
            background: linear-gradient(to bottom, #81c784, var(--clash-green)) !important;
            border-color: #2e7d32 !important;
            box-shadow: 0 5px 0 var(--clash-green-dark) !important;
            transform: translateY(0) !important;
        }
        .option-btn.incorrect {
            background: linear-gradient(to bottom, #e57373, var(--clash-red)) !important;
            border-color: #c62828 !important;
            box-shadow: 0 5px 0 var(--clash-red-dark) !important;
            transform: translateY(0) !important;
        }
        .option-btn:disabled { opacity: 0.7; cursor: not-allowed; }

        .loader {
            border: 10px solid #2c4a7a;
            border-top: 10px solid var(--clash-gold);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin-smooth 1.2s linear infinite;
        }

        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: var(--clash-blue-dark); }
        ::-webkit-scrollbar-thumb { background: var(--clash-gold); border-radius: 6px; border: 3px solid var(--clash-blue-dark); }
        ::-webkit-scrollbar-thumb:hover { background: var(--clash-gold-dark); }

        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100vh;
            padding: 12px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.6s ease-in-out, visibility 0.6s;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            z-index: 1;
        }
        @media (min-width: 640px) { .screen { padding: 24px; } }
        #main-screen { justify-content: flex-start; }
        #loading-screen { 
            justify-content: center; 
            background: radial-gradient(circle, rgba(30,58,94,0.6) 0%, rgba(22,36,71,0.9) 70%);
            position: fixed;
            z-index: 999;
        }
        .screen.active { opacity: 1; visibility: visible; position: relative; z-index: 10; }
        #loading-screen.active { position: fixed; z-index: 999; }
        #main-screen.active { position: absolute; z-index: 10; } 
        #game-screen.active { position: absolute; z-index: 10; } 
        #mind-game-screen.active { position: absolute; z-index: 10; }

        #loading-content-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            max-width: 500px;
        }
        #loading-logo {
            max-width: 320px;
            width: 75%;
            margin-bottom: 2rem;
            animation: fadeInBounce 1.2s ease-out, pulse-shadow 3.5s infinite 1.2s;
        }
        #loading-progress-bar-container {
            width: 100%;
            background-color: var(--clash-panel-border-dark);
            border: 4px solid #1e3a5e;
            border-radius: 16px;
            padding: 5px;
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.6);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        #loading-progress-bar-fill {
            height: 20px;
            width: 0%;
            background: linear-gradient(to right, var(--clash-gold-dark), var(--clash-gold));
            border-radius: 10px;
            transition: width 0.6s ease-out;
            box-shadow: 0 0 12px var(--clash-gold);
        }
        #loading-message {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--clash-text-light);
            text-shadow: 1px 1px 3px #000;
            min-height: 32px;
        }
        #loading-tip {
            margin-top: 2.5rem;
            font-size: 1rem;
            color: #e0f7ff;
            font-style: italic;
            background-color: rgba(0,0,0,0.3);
            padding: 10px 14px;
            border-radius: 10px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: tip-slide-in 1s ease-out;
        }

        .screen-content-wrapper {
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 12px;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        @media (min-width: 640px) { .screen-content-wrapper { padding-bottom: 24px; } }
        #main-screen .screen-content-wrapper {
            justify-content: space-between;
            min-height: calc(100vh - 24px);
            padding-top: 24px; 
        }
        @media (min-width: 640px) { #main-screen .screen-content-wrapper { min-height: calc(100vh - 48px); padding-top: 24px; } }

        #main-screen-header { 
            display: flex; justify-content: center;
            align-items: center; width: 100%; 
            padding: 0.75rem; margin-bottom: 2rem;
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            background-color: #5d4037;
            border-radius: 16px;
            border: 5px solid #3e2723;
            box-shadow: 0 8px 15px rgba(0,0,0,0.6);
            position: relative;
            z-index: 10;
        }

        #main-title {
            text-align: center;
            flex-grow: 1;
            font-size: 3.5rem;
            color: var(--clash-gold);
            text-shadow: 
                -4px -4px 0 var(--clash-brown-dark), 
                4px -4px 0 var(--clash-brown-dark),
                -4px  4px 0 var(--clash-brown-dark),
                4px  4px 0 var(--clash-brown-dark),
                -4px 0 0 var(--clash-brown-dark),
                4px 0 0 var(--clash-brown-dark),
                0 -4px 0 var(--clash-brown-dark),
                0 4px 0 var(--clash-brown-dark),
                8px 8px 10px rgba(0,0,0,0.8);
        }
        @media (min-width: 640px) { #main-title { font-size: 5rem; } }
        @media (min-width: 768px) { #main-title { font-size: 6rem; } }

        #main-screen-buttons-layout { display: flex; flex-direction: column; align-items: center; width: 100%; margin: auto 0; padding-top: 1.5rem; }
        #top-action-buttons { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 1.5rem; width: 100%; padding-bottom: 8px; margin-top: 2.5rem; }

        .hidden { display: none !important; }

        /* --- Improved Pop-up Panels --- */
        #developers-panel-container, #game-mode-panel-container { background-color: rgba(10, 10, 10, 0.9); }
        #developers-panel, #game-mode-panel {
            background-color: var(--clash-panel-bg);
            border: 5px solid var(--clash-panel-border-dark);
            border-top-color: var(--clash-panel-border);
            border-left-color: var(--clash-panel-border);
        }
        #close-developers-panel-btn, #close-game-mode-panel-btn {
            position: absolute; top: 14px; right: 14px; width: 45px; height: 45px;
            background: linear-gradient(to bottom, #e57373, var(--clash-red));
            border: 3px solid #c62828;
            box-shadow: 0 5px 0 #d32f2f;
            color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px;
            font-weight: bold; line-height: 1; cursor: pointer; transition: all 0.3s ease;
        }
        #close-developers-panel-btn:hover, #close-game-mode-panel-btn:hover { transform: scale(1.15) rotate(180deg); }
        #close-developers-panel-btn:active, #close-game-mode-panel-btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #d32f2f; }

        .developer-item {
            background-color: rgba(30,58,94,0.95);
            padding: 1.2rem 1.4rem; border-radius: 16px;
            border: 3px solid rgba(125,168,232,0.5);
        }
        .dev-header { border-bottom: 3px solid rgba(125,168,232,0.4); }
        .dev-role-icon { font-size: 1.9em; color: var(--clash-gold); margin-left: 12px; }
        .dev-role { font-size: 1.25rem; font-weight: 700; color: #fff; font-family: 'Vazirmatn'; }
        .dev-username { color: #fff59d; font-weight: bold; font-size: 1.35rem; }
        .dev-description { font-size: 1rem; color: #e0f7ff; line-height: 1.7; font-family: 'Vazirmatn'; }

        #game-mode-panel .btn-clash-primary {
            padding: 18px 36px;
            font-size: 1.6rem;
            width: 100%;
            max-width: 350px;
        }
        #game-mode-panel .btn-clash-primary .icon {
            font-size: 2.2rem;
            margin-left: 14px;
        }

        #timer-container {
            position: relative;
            width: 70px;
            height: 70px;
        }
        #timer-svg {
            transform: rotate(-90deg);
        }
        .timer-circle {
            fill: none;
            stroke-width: 10;
        }
        .timer-bg {
            stroke: var(--clash-panel-border-dark);
        }
        .timer-progress {
            stroke: var(--clash-gold);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-in-out;
        }
        #timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Lilita One', cursive;
            font-size: 2rem;
            color: var(--clash-gold);
            text-shadow: 3px 3px 3px #000;
        }

        /* --- IMPROVED MIND GAME STYLES --- */
        #mind-game-screen .screen-content-wrapper {
            justify-content: center;
        }
        #falling-sentence-container {
            height: 250px;
            width: 100%;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 2.5rem;
        }
        .falling-sentence {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--clash-gold);
            text-shadow: 3px 3px 5px #000;
            animation: fall-smooth-fade 5s ease-in-out forwards;
        }
        #mind-game-input-area {
            width: 100%;
            max-width: 600px;
        }
    </style>
</head>
<body>
    <div id="loading-screen" class="screen active">
        <div id="loading-content-box">
            <img id="loading-logo" src="https://up.20script.ir/file/7e7a-Copilot-20250812-110015-removebg-preview.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ø²ÛŒ Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§">
            <h1 class="text-4xl sm:text-6xl font-bold clash-font text-[var(--clash-gold)]" style="text-shadow: 4px 4px 5px #000;">Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§</h1>
            <div id="loading-progress-bar-container">
                <div id="loading-progress-bar-fill"></div>
            </div>
            <p id="loading-message" class="text-xl">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ù‡Ø§Ù† Ù…Ø§ÙÛŒØ§...</p>
            <p id="loading-tip">ğŸ” Ø±Ø§Ø²Ù‡Ø§ Ø¯Ø± Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§ Ù¾Ù†Ù‡Ø§Ù† Ù‡Ø³ØªÙ†Ø¯... ğŸ”</p>
        </div>
    </div>

    <div id="main-screen" class="screen">
        <div class="screen-content-wrapper">
            <div>
                <div id="main-screen-header">
                    <h1 id="main-title" class="clash-font">Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§</h1>
                </div>
            </div>

            <div id="main-screen-buttons-layout" class="pb-3 sm:pb-6">
                <button id="start-game-btn" class="btn-clash btn-clash-primary clash-font py-5 px-10 text-3xl">Ø´Ø±ÙˆØ¹ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ</button>
                <button id="online-game-btn" class="btn-clash btn-clash-secondary clash-font mt-5">Ù†Ø¨Ø±Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</button>
                <div id="top-action-buttons">
                    <button id="challenge-btn" class="btn-clash btn-clash-secondary clash-font">Ù…Ø§Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡</button>
                    <button id="developers-btn" class="btn-clash btn-clash-secondary clash-font">ğŸ‘¥ ØªÛŒÙ… Ø³Ø§Ø²Ù†Ø¯Ù‡</button>
                    <button id="coordination-btn" class="btn-clash btn-clash-secondary clash-font">Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-screen" class="screen">
        <div class="screen-content-wrapper justify-start">
            <div class="flex justify-between items-center mb-5 sm:mb-7 p-4 bg-[rgba(0,0,0,0.4)] rounded-xl text-xl w-full">
                <button id="back-to-main-btn-mafia" class="btn-clash btn-clash-secondary clash-font text-base">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø´Ù‡Ø±</button>
                <div class="font-bold">Ø³Ø·Ø­: <span id="stage-display" class="clash-font text-[var(--clash-gold)] text-3xl">1</span></div>
                <div id="timer-container">
                    <svg id="timer-svg" width="70" height="70" viewBox="0 0 70 70">
                        <circle class="timer-circle timer-bg" cx="35" cy="35" r="30"></circle>
                        <circle id="timer-progress-circle" class="timer-circle timer-progress" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <span id="timer-text">25</span>
                </div>
            </div>
            <div id="question-container" class="panel-clash panel-visible p-5 sm:p-7 rounded-xl mb-5 sm:mb-7 min-h-[250px] flex flex-col justify-center w-full">
                <p id="question-text" class="text-2xl md:text-3xl mb-7 text-center leading-loose font-bold">Ø³ÙˆØ§Ù„ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-5"></div>
                <p id="question-explanation" class="text-base mt-5 text-gray-100 bg-black/40 p-3 rounded-lg text-center hidden"></p>
            </div>
            <div id="game-feedback" class="text-center text-xl font-semibold my-5 h-10 clash-font"></div>
        </div>
    </div>

    <div id="mind-game-screen" class="screen">
        <div class="screen-content-wrapper justify-start">
            <div class="flex justify-between items-center mb-5 sm:mb-7 p-4 bg-[rgba(0,0,0,0.4)] rounded-xl text-xl w-full">
                <button id="back-to-main-btn-mind" class="btn-clash btn-clash-secondary clash-font text-base">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø´Ù‡Ø±</button>
                <div class="font-bold">Ø³Ø·Ø­: <span id="mind-game-stage-display" class="clash-font text-[var(--clash-gold)] text-3xl">1</span></div>
                <div class="font-bold">Ø§Ù…ØªÛŒØ§Ø²Ø§Øª: <span id="mind-game-score-display" class="clash-font text-[var(--clash-gold)] text-3xl">0</span></div>
            </div>
            
            <div class="panel-clash p-7 w-full text-center">
                <h2 id="mind-game-instruction" class="text-3xl font-bold mb-5">Ø±Ù…Ø² Ø±Ø§ Ø­ÙØ¸ Ú©Ù†!</h2>
                <div id="falling-sentence-container">
                    <!-- Falling text injected by JS -->
                </div>
                
                <div id="mind-game-input-area" class="hidden mx-auto">
                    <p class="mb-5">Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†:</p>
                    <input type="text" id="mind-game-input" class="input-clash w-full text-center text-xl mb-5" dir="rtl">
                    <button id="mind-game-submit-btn" class="btn-clash btn-clash-primary">Ø§Ø±Ø³Ø§Ù„ Ø±Ù…Ø²</button>
                </div>
                
                <div id="mind-game-feedback" class="text-center text-xl font-semibold my-5 h-10 clash-font"></div>
            </div>
        </div>
    </div>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-85 flex items-center justify-center p-5 panel-hidden z-50">
        <div class="panel-clash p-7 sm:p-9 rounded-xl max-w-lg w-full text-center">
            <h3 id="modal-title" class="text-3xl sm:text-4xl font-bold mb-5 clash-font text-[var(--clash-gold)]" style="text-shadow: 3px 3px 4px #000;">Ù‡Ø´Ø¯Ø§Ø±</h3>
            <div id="modal-content-dynamic">
                <p id="modal-message" class="mb-4 text-lg"></p>
                <div class="flex justify-center gap-5 mt-5">
                    <button id="modal-confirm-btn" class="btn-clash btn-clash-primary clash-font">Ù‚Ø¨ÙˆÙ„</button>
                    <button id="modal-cancel-btn" class="btn-clash btn-clash-secondary clash-font hidden">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </div>
        </div>
    </div>

    <div id="developers-panel-container" class="fixed inset-0 flex items-center justify-center p-5 panel-hidden z-40">
        <div id="developers-panel" class="panel-clash p-7 sm:p-11 rounded-xl max-w-lg w-full relative">
            <button id="close-developers-panel-btn">âœ•</button>
            <h3 class="text-center text-4xl font-bold mb-7 clash-font text-[var(--clash-gold)]" style="text-shadow: 3px 3px 4px #000;">ğŸ‘¥ ØªÛŒÙ… Ø³Ø§Ø²Ù†Ø¯Ù‡</h3>
            <div class="space-y-5">
                <div class="developer-item">
                    <div class="dev-header flex items-center mb-3 pb-3">
                        <span class="dev-role-icon">ğŸ› ï¸</span>
                        <span class="dev-role">ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†</span>
                    </div>
                    <p class="dev-username">Ø§Ù…ÛŒØ± Ø±Ø¶Ø§ÛŒÛŒ Ùˆ Ø³Ø§Ø±Ø§ Ù…Ø­Ù…Ø¯ÛŒ</p>
                    <p class="dev-description">Ø·Ø±Ø§Ø­ÛŒ Ø³ÛŒØ³ØªÙ… Ùˆ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø¯Ù‡Ø§ Ø¨Ø§ ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ú©Ø§Ø±Ø§ÛŒÛŒ Ùˆ Ø§Ù…Ù†ÛŒØª.</p>
                </div>
                <div class="developer-item">
                    <div class="dev-header flex items-center mb-3 pb-3">
                        <span class="dev-role-icon">ğŸ–Œï¸</span>
                        <span class="dev-role">Ø·Ø±Ø§Ø­ Ú¯Ø±Ø§ÙÛŒÚ©</span>
                    </div>
                    <p class="dev-username">Ø±Ø¶Ø§ Ú©Ø±ÛŒÙ…ÛŒ</p>
                    <p class="dev-description">Ø®Ù„Ù‚ ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ§Ù† Ø¨Ø±Ø§ÛŒ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø±ØªØ±.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="game-mode-panel-container" class="fixed inset-0 flex items-center justify-center p-5 panel-hidden z-40">
        <div id="game-mode-panel" class="panel-clash p-7 sm:p-11 rounded-xl max-w-lg w-full relative text-center">
            <button id="close-game-mode-panel-btn">âœ•</button>
            <h3 class="text-center text-4xl font-bold mb-9 clash-font text-[var(--clash-gold)]" style="text-shadow: 3px 3px 4px #000;">Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆØ¯</h3>
            <div class="space-y-7 flex flex-col items-center">
                <button id="mafia-mode-btn" class="btn-clash btn-clash-primary clash-font">
                    Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÙÛŒØ§
                </button>
                <button id="mind-game-mode-btn" class="btn-clash btn-clash-primary clash-font">
                    Ú†Ø§Ù„Ø´ Ø°Ù‡Ù†ÛŒ
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- NEW MAFIA GAME DATA WITH DIFFERENT QUESTIONS ---
        const mafiaGameData = [
            {
                question: "Ø¯Ø± Ø¨Ø§Ø²ÛŒ Ù…Ø§ÙÛŒØ§ØŒ Ù†Ù‚Ø´ 'Ø´Ø§Ù‡Ø²Ø§Ø¯Ù‡' Ú†Ù‡ ØªÙˆØ§Ù†Ø§ÛŒÛŒ ÙˆÛŒÚ˜Ù‡â€ŒØ§ÛŒ Ø¯Ø§Ø±Ø¯ØŸ",
                options: ["Ù†Ø¬Ø§Øª Ø¯Ùˆ Ù†ÙØ± Ø¯Ø± Ø´Ø¨", "Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù…Ø§ÙÛŒØ§ Ø¨Ø§ Ø§Ø­ØªÙ…Ø§Ù„ 50%", "Ø­Ù‚ ÙˆØªÙˆ Ø¯Ø± Ø±Ø§ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ Ø±ÙˆØ²", "Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø´Ù‡Ø±ÙˆÙ†Ø¯"],
                answer: "Ø­Ù‚ ÙˆØªÙˆ Ø¯Ø± Ø±Ø§ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ Ø±ÙˆØ²",
                explanation: "Ø´Ø§Ù‡Ø²Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÛŒÚ© Ø¨Ø§Ø± Ø¯Ø± Ø¨Ø§Ø²ÛŒØŒ Ø±Ø§ÛŒâ€ŒÚ¯ÛŒØ±ÛŒ Ø±ÙˆØ² Ø±Ø§ ÙˆØªÙˆ Ú©Ù†Ø¯ Ùˆ ÙØ±Ø¯ Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†Ø¯."
            },
            {
                question: "ØªÛŒÙ… Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ø´Ú©Ø³Øª Ø¯Ù‡Ù†Ø¯ØŸ",
                options: ["Ø¨Ø§ Ø­Ø°Ù ØªÙ…Ø§Ù… Ù…Ø§ÙÛŒØ§", "Ø¨Ø§ ØªØ³Ø§ÙˆÛŒ ØªØ¹Ø¯Ø§Ø¯", "Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ù‡Ø¨Ø± Ø¬Ø¯ÛŒØ¯", "Ø¨Ø§ Ù…Ø°Ø§Ú©Ø±Ù‡ Ø´Ø¨Ø§Ù†Ù‡"],
                answer: "Ø¨Ø§ Ø­Ø°Ù ØªÙ…Ø§Ù… Ù…Ø§ÙÛŒØ§",
                explanation: "Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ù¾ÛŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ø§Ú¯Ø± ØªÙ…Ø§Ù… Ø§Ø¹Ø¶Ø§ÛŒ Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø®Ø§Ø±Ø¬ Ú©Ù†Ù†Ø¯."
            },
            {
                question: "Ù†Ù‚Ø´ 'Ø¬Ø§Ø³ÙˆØ³' Ø¯Ø± ØªÛŒÙ… Ù…Ø§ÙÛŒØ§ Ú†Ù‡ Ù…Ø²ÛŒØªÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ",
                options: ["Ø´Ù†ÙˆØ¯ Ù…Ú©Ø§Ù„Ù…Ø§Øª Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù†", "ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ ÛŒÚ© Ù†ÙØ±", "Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù†Ù‚Ø´ Ø¯Ø± Ø±ÙˆØ²", "Ø­Ù…Ø§ÛŒØª Ø§Ø² ÛŒÚ© Ù…Ø§ÙÛŒØ§"],
                answer: "Ø´Ù†ÙˆØ¯ Ù…Ú©Ø§Ù„Ù…Ø§Øª Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù†",
                explanation: "Ø¬Ø§Ø³ÙˆØ³ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø±Ø§ Ø¬Ø§Ø³ÙˆØ³ÛŒ Ú©Ù†Ø¯ Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù‡ ØªÛŒÙ… Ù…Ø§ÙÛŒØ§ Ø¨Ø¯Ù‡Ø¯."
            },
            {
                question: "Ø¨Ø§Ø²ÛŒ Ø²Ù…Ø§Ù†ÛŒ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ØŸ",
                options: ["ØªÙ…Ø§Ù… Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø­Ø°Ù Ø´ÙˆÙ†Ø¯", "Ù…Ø§ÙÛŒØ§ Ø§Ú©Ø«Ø±ÛŒØª Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯", "Ù¾Ø³ Ø§Ø² Û· Ø¯ÙˆØ±", "Ø¨Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø§Ø¯Ø´Ø§Ù‡"],
                answer: "Ù…Ø§ÙÛŒØ§ Ø§Ú©Ø«Ø±ÛŒØª Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯",
                explanation: "Ø§Ú¯Ø± Ù…Ø§ÙÛŒØ§ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§Ø¨Ø± ÛŒØ§ Ø¨ÛŒØ´ØªØ±ÛŒ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ù¾ÛŒØ±ÙˆØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯."
            }
        ];

        // --- NEW MIND GAME DATA WITH DIFFERENT SENTENCES ---
        const mindGameSentences = [
            "Ù¾Ø´Øª Ù‡Ø± Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø²Ø±Ú¯ØŒ Ø´Ú©Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ§Ø¯ÛŒ Ù†Ù‡ÙØªÙ‡ Ø§Ø³Øª",
            "Ø²Ù…Ø§Ù† Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø¹Ù„Ù… Ø§Ø³Øª Ø§Ù…Ø§ Ø´Ø§Ú¯Ø±Ø¯Ø§Ù†Ø´ Ø±Ø§ Ù…ÛŒâ€ŒÚ©Ø´Ø¯",
            "Ø±ÙˆÛŒØ§Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ø§Ù‚Ø¯Ø§Ù… ÙÙ‚Ø· Ø®ÛŒØ§Ù„ Ù‡Ø³ØªÙ†Ø¯",
            "Ù‚Ø¯Ø±Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ø± Ú©Ù†ØªØ±Ù„ Ø®ÙˆÛŒØ´ØªÙ† Ø§Ø³Øª",
            "ØªØºÛŒÛŒØ± Ø¬Ù‡Ø§Ù† Ø§Ø² ØªØºÛŒÛŒØ± Ø®ÙˆØ¯ Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯"
        ];

        // --- DOM Elements (unchanged structure, improved selectors) ---
        const loadingScreen = document.getElementById('loading-screen');
        const mainScreen = document.getElementById('main-screen');
        const gameScreen = document.getElementById('game-screen');
        const mindGameScreen = document.getElementById('mind-game-screen');

        const startGameBtn = document.getElementById('start-game-btn');
        const developersBtn = document.getElementById('developers-btn');
        const onlineGameBtn = document.getElementById('online-game-btn');
        const challengeBtn = document.getElementById('challenge-btn');
        const coordinationBtn = document.getElementById('coordination-btn');

        // Mafia Game Elements
        const backToMainBtnMafia = document.getElementById('back-to-main-btn-mafia');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const stageDisplay = document.getElementById('stage-display');
        const gameFeedback = document.getElementById('game-feedback');
        const questionExplanation = document.getElementById('question-explanation');
        const timerText = document.getElementById('timer-text');
        const timerProgressCircle = document.getElementById('timer-progress-circle');
        const circleRadius = 30;
        const circleCircumference = 2 * Math.PI * circleRadius;
        timerProgressCircle.style.strokeDasharray = `${circleCircumference} ${circleCircumference}`;
        timerProgressCircle.style.strokeDashoffset = circleCircumference;

        // Mind Game Elements
        const backToMainBtnMind = document.getElementById('back-to-main-btn-mind');
        const mindGameInstruction = document.getElementById('mind-game-instruction');
        const fallingSentenceContainer = document.getElementById('falling-sentence-container');
        const mindGameInputArea = document.getElementById('mind-game-input-area');
        const mindGameInput = document.getElementById('mind-game-input');
        const mindGameSubmitBtn = document.getElementById('mind-game-submit-btn');
        const mindGameFeedback = document.getElementById('mind-game-feedback');
        const mindGameStageDisplay = document.getElementById('mind-game-stage-display');
        const mindGameScoreDisplay = document.getElementById('mind-game-score-display');

        // Modal & Panels
        const modalContainer = document.getElementById('modal-container');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const developersPanelContainer = document.getElementById('developers-panel-container');
        const closeDevelopersPanelBtn = document.getElementById('close-developers-panel-btn');
        const gameModePanelContainer = document.getElementById('game-mode-panel-container');
        const closeGameModePanelBtn = document.getElementById('close-game-mode-panel-btn');
        const mafiaModeBtn = document.getElementById('mafia-mode-btn');
        const mindGameModeBtn = document.getElementById('mind-game-mode-btn');

        // --- Game State ---
        let currentMafiaStage = 0;
        let mafiaTimerInterval;
        let mafiaGameTime = 25; // Increased time for better pace

        let currentMindGameStage = 0;
        let mindGameScore = 0;
        let currentMindGameSentence = '';

        // --- Navigation & Modals ---
        function navigateTo(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showModal({ title, message, onConfirm, onCancel }) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalCancelBtn.classList.add('hidden');
            modalConfirmBtn.onclick = () => { hideModal(); if (onConfirm) onConfirm(); };
            if (onCancel) {
                modalCancelBtn.classList.remove('hidden');
                modalCancelBtn.onclick = () => { hideModal(); onCancel(); };
            }
            modalContainer.classList.remove('panel-hidden');
            modalContainer.classList.add('panel-visible');
        }

        function hideModal() {
            modalContainer.classList.remove('panel-visible');
            modalContainer.classList.add('panel-hidden');
        }

        function createBackToMainConfirmation(onConfirm) {
            showModal({
                title: 'Ø®Ø±ÙˆØ¬ Ø§Ø² Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒØŸ',
                message: 'Ø¢ÛŒØ§ ÙˆØ§Ù‚Ø¹Ø§Ù‹ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²ÛŒ Ø±Ø§ ØªØ±Ú© Ú©Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ù¾ÛŒØ´Ø±ÙØªâ€ŒÙ‡Ø§ Ø§Ø² Ø¨ÛŒÙ† Ø®ÙˆØ§Ù‡Ø¯ Ø±ÙØª.',
                onConfirm,
                onCancel: () => {}
            });
        }

        // --- MAFIA GAME LOGIC (Improved with smoother transitions) ---
        function cleanupMafiaScreen() {
            optionsContainer.innerHTML = '';
            gameFeedback.textContent = '';
            questionExplanation.textContent = '';
            questionExplanation.classList.add('hidden');
        }

        function updateMafiaTimerUI(timeRemaining) {
            timerText.textContent = timeRemaining;
            const percentage = timeRemaining / mafiaGameTime;
            const offset = circleCircumference * (1 - percentage);
            timerProgressCircle.style.strokeDashoffset = offset;
            timerProgressCircle.style.stroke = timeRemaining <= 7 ? 'var(--clash-red)' : 'var(--clash-gold)';
        }

        function startMafiaTimer() {
            clearInterval(mafiaTimerInterval);
            let timeRemaining = mafiaGameTime;
            updateMafiaTimerUI(timeRemaining);
            mafiaTimerInterval = setInterval(() => {
                timeRemaining--;
                updateMafiaTimerUI(timeRemaining);
                if (timeRemaining <= 0) {
                    clearInterval(mafiaTimerInterval);
                    handleMafiaAnswer(null);
                }
            }, 1000);
        }

        function loadMafiaStage() {
            cleanupMafiaScreen();
            const stageData = mafiaGameData[currentMafiaStage];
            stageDisplay.textContent = currentMafiaStage + 1;
            questionText.textContent = stageData.question;
            mafiaGameTime = 25;

            stageData.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'option-btn clash-font text-2xl';
                button.onclick = () => handleMafiaAnswer(option, button);
                optionsContainer.appendChild(button);
            });
            startMafiaTimer();
        }

        function handleMafiaAnswer(selectedAnswer, selectedButton = null) {
            clearInterval(mafiaTimerInterval);
            const stageData = mafiaGameData[currentMafiaStage];
            const isCorrect = selectedAnswer === stageData.answer;

            Array.from(optionsContainer.children).forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === stageData.answer) btn.classList.add('correct');
                else if (btn === selectedButton) btn.classList.add('incorrect');
            });

            if (selectedAnswer === null) gameFeedback.textContent = 'â° Ø²Ù…Ø§Ù† ØªÙ…Ø§Ù… Ø´Ø¯! â°';
            else if (isCorrect) gameFeedback.textContent = 'ğŸ‘ Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯!';
            else gameFeedback.textContent = 'ğŸ‘ Ù†Ø§Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯.';

            questionExplanation.textContent = 'Ø¬Ø²Ø¦ÛŒØ§Øª: ' + stageData.explanation;
            questionExplanation.classList.remove('hidden');

            setTimeout(() => {
                currentMafiaStage++;
                if (currentMafiaStage < mafiaGameData.length) {
                    loadMafiaStage();
                } else {
                    showMafiaGameOver();
                }
            }, 5000); // Increased delay for better reading
        }

        function showMafiaGameOver() {
            showModal({
                title: 'Ù¾Ø§ÛŒØ§Ù† Ø¹Ù…Ù„ÛŒØ§Øª! ğŸ‰',
                message: 'Ø´Ù…Ø§ ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ù¾Ø´Øª Ø³Ø± Ú¯Ø°Ø§Ø´ØªÛŒØ¯. Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø± Ø¨Ù‡ Ø´Ù‡Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯ÛŒØ¯.',
                onConfirm: () => navigateTo('main-screen')
            });
        }

        function startMafiaGame() {
            currentMafiaStage = 0;
            navigateTo('game-screen');
            loadMafiaStage();
        }

        // --- MIND GAME LOGIC (Improved with longer animation) ---
        function startMindGame() {
            currentMindGameStage = 0;
            mindGameScore = 0;
            mindGameScoreDisplay.textContent = mindGameScore;
            navigateTo('mind-game-screen');
            loadMindGameRound();
        }

        function loadMindGameRound() {
            mindGameFeedback.textContent = '';
            mindGameInput.value = '';
            mindGameInput.classList.remove('correct', 'incorrect');
            fallingSentenceContainer.innerHTML = '';

            if (currentMindGameStage >= mindGameSentences.length) {
                showMindGameOver();
                return;
            }

            mindGameStageDisplay.textContent = currentMindGameStage + 1;
            currentMindGameSentence = mindGameSentences[currentMindGameStage];

            mindGameInstruction.textContent = 'Ø±Ù…Ø² Ø±Ø§ Ø­ÙØ¸ Ú©Ù†!';
            mindGameInputArea.classList.add('hidden');
            const sentenceEl = document.createElement('div');
            sentenceEl.textContent = currentMindGameSentence;
            sentenceEl.className = 'falling-sentence';
            fallingSentenceContainer.appendChild(sentenceEl);

            setTimeout(() => {
                mindGameInstruction.textContent = 'Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†!';
                fallingSentenceContainer.innerHTML = '';
                mindGameInputArea.classList.remove('hidden');
                mindGameInput.focus();
            }, 5000); // Matches new animation duration
        }

        function handleMindGameAnswer() {
            const userAnswer = mindGameInput.value.trim();
            const isCorrect = userAnswer === currentMindGameSentence;

            if (isCorrect) {
                mindGameScore++;
                mindGameScoreDisplay.textContent = mindGameScore;
                mindGameFeedback.textContent = 'ğŸ‘ Ø¹Ø§Ù„ÛŒ!';
                mindGameFeedback.style.color = 'var(--clash-green)';
            } else {
                mindGameFeedback.textContent = 'ğŸ‘ Ø§Ø´ØªØ¨Ø§Ù‡! Ø±Ù…Ø² ØµØ­ÛŒØ­: ' + currentMindGameSentence;
                mindGameFeedback.style.color = 'var(--clash-red)';
            }

            currentMindGameStage++;

            setTimeout(loadMindGameRound, 4000); // Longer wait for feedback
        }

        function showMindGameOver() {
            showModal({
                title: 'Ù¾Ø§ÛŒØ§Ù† Ú†Ø§Ù„Ø´ Ø°Ù‡Ù†ÛŒ! ğŸ‰',
                message: `Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: ${mindGameScore} Ø§Ø² ${mindGameSentences.length}. Ø¨Ø±Ø§ÛŒ ØªÚ©Ø±Ø§Ø± Ø¨Ù‡ Ø´Ù‡Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯ÛŒØ¯.`,
                onConfirm: () => navigateTo('main-screen')
            });
        }

        // --- Event Listeners ---
        startGameBtn.addEventListener('click', () => {
            gameModePanelContainer.classList.remove('panel-hidden');
            gameModePanelContainer.classList.add('panel-visible');
        });

        developersBtn.addEventListener('click', () => {
            developersPanelContainer.classList.remove('panel-hidden');
            developersPanelContainer.classList.add('panel-visible');
        });

        closeGameModePanelBtn.addEventListener('click', () => {
            gameModePanelContainer.classList.remove('panel-visible');
            gameModePanelContainer.classList.add('panel-hidden');
        });

        mafiaModeBtn.addEventListener('click', () => {
            gameModePanelContainer.classList.remove('panel-visible');
            gameModePanelContainer.classList.add('panel-hidden');
            startMafiaGame();
        });

        mindGameModeBtn.addEventListener('click', () => {
            gameModePanelContainer.classList.remove('panel-visible');
            gameModePanelContainer.classList.add('panel-hidden');
            startMindGame();
        });

        backToMainBtnMafia.addEventListener('click', () => createBackToMainConfirmation(() => {
            clearInterval(mafiaTimerInterval);
            navigateTo('main-screen');
        }));

        backToMainBtnMind.addEventListener('click', () => createBackToMainConfirmation(() => navigateTo('main-screen')));

        mindGameSubmitBtn.addEventListener('click', handleMindGameAnswer);
        mindGameInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleMindGameAnswer(); });

        closeDevelopersPanelBtn.addEventListener('click', () => {
            developersPanelContainer.classList.remove('panel-visible');
            developersPanelContainer.classList.add('panel-hidden');
        });

        function showComingSoonModal() {
            showModal({
                title: 'Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª...',
                message: 'Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯. Ù…Ù†ØªØ¸Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¨Ø§Ø´ÛŒØ¯!',
                onConfirm: () => {}
            });
        }
        onlineGameBtn.addEventListener('click', showComingSoonModal);
        challengeBtn.addEventListener('click', showComingSoonModal);
        coordinationBtn.addEventListener('click', showComingSoonModal);

        // --- Loading Sequence (Improved with more tips) ---
        const progressBarFill = document.getElementById('loading-progress-bar-fill');
        const loadingMessage = document.getElementById('loading-message');
        const loadingTips = [
            "Ù…Ø§ÙÛŒØ§ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø³Ø§ÛŒÙ‡ Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
            "Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø´Ù†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯.",
            "Ø¬Ø§Ø³ÙˆØ³â€ŒÙ‡Ø§ Ú©Ù„ÛŒØ¯ Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù‡Ø³ØªÙ†Ø¯.",
            "Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ú†Ø§Ù„Ø´ Ø°Ù‡Ù†ÛŒ Ø­ÛŒØ§ØªÛŒ Ø§Ø³Øª!"
        ];
        let loadProgress = 0;
        const loadingInterval = setInterval(() => {
            loadProgress += 8;
            progressBarFill.style.width = `${loadProgress}%`;

            if (loadProgress >= 100) {
                clearInterval(loadingInterval);
                loadingMessage.textContent = 'ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ù‡Ø§Ù† Ù…Ø§ÙÛŒØ§!';
                setTimeout(() => {
                    loadingScreen.classList.remove('active');
                    mainScreen.classList.add('active');
                    startGameBtn.classList.add('breathing');
                }, 600);
            } else if (loadProgress > 40 && loadProgress < 60) {
                loadingMessage.textContent = 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ù‚Ø´Ù‡ Ø´Ù‡Ø±...';
            } else if (loadProgress > 70) {
                loadingMessage.textContent = 'ØªÙ†Ø¸ÛŒÙ… Ù‚ÙˆØ§Ù†ÛŒÙ† Ù†Ù‡Ø§ÛŒÛŒ...';
            }

            document.getElementById('loading-tip').textContent = `ğŸ’¡ Ø±Ø§Ø²: ${loadingTips[Math.floor(Math.random() * loadingTips.length)]}`;
        }, 250);
    </script>
</body>
</html>
