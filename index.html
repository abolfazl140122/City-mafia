<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>شهر مافیا: نبرد ذهن‌ها</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- GLOBAL VARIABLES & RESET --- */
        :root {
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --accent-gold: #fbbf24;
            --accent-gold-glow: rgba(251, 191, 36, 0.5);
            --accent-red: #ef4444;
            --accent-green: #10b981;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-main: 'Vazirmatn', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-darker);
            background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        /* --- BACKGROUND PARTICLES --- */
        #particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
        }
        .particle {
            position: absolute;
            background: var(--accent-gold);
            border-radius: 50%;
            opacity: 0.3;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

        /* --- UI COMPONENTS --- */
        .screen {
            position: absolute;
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px;
            opacity: 0; visibility: hidden;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(0.95);
            z-index: 10;
        }
        .screen.active {
            opacity: 1; visibility: visible;
            transform: scale(1);
            z-index: 20;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .glass-panel::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
            opacity: 0.5;
        }

        .btn-gold {
            background: linear-gradient(135deg, #b45309 0%, #fbbf24 50%, #b45309 100%);
            background-size: 200% auto;
            color: #000;
            font-weight: 800;
            border: none;
            border-radius: 12px;
            padding: 14px 32px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--accent-gold-glow);
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            position: relative;
            overflow: hidden;
        }
        .btn-gold:hover {
            background-position: right center;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--accent-gold-glow);
        }
        .btn-gold:active { transform: translateY(1px); }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-outline:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
        }

        .title-text {
            font-weight: 900;
            background: linear-gradient(to bottom, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        /* --- GAME SPECIFIC --- */
        .option-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: right;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .option-card:hover {
            background: rgba(251, 191, 36, 0.15);
            border-color: var(--accent-gold);
            transform: translateX(-5px);
        }
        .option-card.correct {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: var(--accent-green) !important;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }
        .option-card.wrong {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: var(--accent-red) !important;
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }

        .timer-ring {
            transition: stroke-dashoffset 1s linear;
        }

        /* --- ANIMATIONS --- */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        .input-glow {
            background: transparent;
            border: 2px solid rgba(255,255,255,0.2);
            color: var(--accent-gold);
            font-size: 1.5rem;
            text-align: center;
            border-radius: 12px;
            transition: 0.3s;
        }
        .input-glow:focus {
            outline: none;
            border-color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
        }

        .hidden-visually { opacity: 0; pointer-events: none; }
        
        /* Modal */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden;
            transition: 0.3s;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
    </style>
</head>
<body>

    <!-- PARTICLES BACKGROUND -->
    <div id="particles"></div>

    <!-- LOADING SCREEN -->
    <div id="screen-loading" class="screen active">
        <div class="glass-panel p-8 flex flex-col items-center max-w-sm w-full">
            <i class="fas fa-user-secret text-6xl text-[var(--accent-gold)] mb-4 animate-bounce"></i>
            <h1 class="text-3xl font-bold mb-6 title-text">شـهـر مـافـیـا</h1>
            <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden relative">
                <div id="loading-bar" class="h-full bg-[var(--accent-gold)] w-0 transition-all duration-300 ease-out shadow-[0_0_10px_var(--accent-gold)]"></div>
            </div>
            <p id="loading-text" class="mt-3 text-sm text-slate-400 font-mono">در حال رمزگشایی پرونده‌ها...</p>
        </div>
    </div>

    <!-- MAIN MENU -->
    <div id="screen-menu" class="screen">
        <div class="glass-panel p-8 sm:p-12 w-full max-w-md flex flex-col gap-5 text-center relative">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[var(--accent-gold)] to-transparent"></div>
            
            <h1 class="text-4xl sm:text-5xl font-black title-text mb-2">MAFIA CITY</h1>
            <p class="text-slate-400 text-sm mb-6">آیا می‌توانید حقیقت را کشف کنید؟</p>
            
            <button onclick="Game.startMode('quiz')" class="btn-gold w-full flex items-center justify-center gap-3">
                <i class="fas fa-clipboard-question"></i> اتاق بازجویی (سناریو)
            </button>
            
            <button onclick="Game.startMode('mind')" class="btn-gold w-full flex items-center justify-center gap-3" style="filter: hue-rotate(200deg);">
                <i class="fas fa-brain"></i> چالش ذهن (حافظه)
            </button>

            <div class="grid grid-cols-2 gap-3 mt-4">
                <button onclick="UI.showModal('about')" class="btn-outline text-sm"><i class="fas fa-users"></i> سازندگان</button>
                <button onclick="UI.showToast('به زودی فعال می‌شود')" class="btn-outline text-sm"><i class="fas fa-trophy"></i> رتبه‌بندی</button>
            </div>
        </div>
    </div>

    <!-- QUIZ GAME SCREEN -->
    <div id="screen-quiz" class="screen">
        <div class="w-full max-w-lg flex flex-col h-full justify-start pt-10 pb-5">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6 px-2">
                <button onclick="Game.quit()" class="text-slate-400 hover:text-white transition"><i class="fas fa-arrow-right text-xl"></i></button>
                <div class="glass-panel px-4 py-2 rounded-full border-none bg-slate-800/50">
                    <span class="text-[var(--accent-gold)] font-bold text-xl" id="quiz-timer">20</span>
                </div>
                <div class="text-slate-300 font-bold">مرحله <span id="quiz-stage" class="text-white text-xl">1</span></div>
            </div>

            <!-- Question Card -->
            <div class="glass-panel p-6 sm:p-8 flex-grow flex flex-col justify-center mb-6 relative">
                <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-[var(--accent-gold)] text-black font-bold px-3 py-1 rounded text-xs shadow-lg">پرونده محرمانه</div>
                <p id="quiz-question" class="text-xl sm:text-2xl font-bold leading-9 text-center text-slate-100 mb-4">سوال اینجا قرار می‌گیرد...</p>
                <div id="quiz-options" class="grid grid-cols-1 gap-3 w-full mt-auto"></div>
            </div>
        </div>
    </div>

    <!-- MIND GAME SCREEN -->
    <div id="screen-mind" class="screen">
        <div class="w-full max-w-lg flex flex-col items-center">
            <div class="w-full flex justify-between items-center mb-8 px-4">
                <button onclick="Game.quit()" class="text-slate-400 hover:text-white"><i class="fas fa-arrow-right text-xl"></i></button>
                <div class="text-[var(--accent-gold)] font-bold text-lg">امتیاز: <span id="mind-score">0</span></div>
            </div>

            <div class="glass-panel p-8 w-full text-center min-h-[300px] flex flex-col justify-center items-center relative">
                <i class="fas fa-fingerprint text-6xl text-slate-700 absolute opacity-20 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></i>
                
                <h3 id="mind-instruction" class="text-xl font-bold mb-6 text-[var(--accent-gold)]">رمز را به خاطر بسپارید</h3>
                
                <div id="mind-display-area" class="h-24 flex items-center justify-center w-full">
                    <p id="mind-text" class="text-2xl sm:text-3xl font-black text-white drop-shadow-lg tracking-wide transition-all duration-500"></p>
                </div>

                <div id="mind-input-area" class="w-full hidden mt-4">
                    <input type="text" id="mind-input" class="input-glow w-full p-3 mb-4" placeholder="رمز را وارد کنید..." dir="rtl" autocomplete="off">
                    <button id="mind-submit" class="btn-gold w-full py-3">تایید رمز</button>
                </div>
            </div>
            <p id="mind-feedback" class="mt-6 text-lg font-bold h-8"></p>
        </div>
    </div>

    <!-- MODAL -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="glass-panel p-6 max-w-sm w-full mx-4 text-center transform scale-95 transition-transform duration-300" id="modal-box">
            <div id="modal-content"></div>
            <button onclick="UI.closeModal()" class="mt-6 btn-outline w-full border-slate-600 hover:bg-slate-700">بستن</button>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl border border-slate-600 opacity-0 transition-opacity duration-300 z-50 pointer-events-none font-bold text-sm flex items-center gap-2">
        <i class="fas fa-info-circle text-[var(--accent-gold)]"></i>
        <span id="toast-msg">پیام</span>
    </div>

    <script>
        // --- GAME DATA (SCENARIOS) ---
        const QUIZ_DATA = [
            {
                question: "در یک بازی ۱۰ نفره، کارآگاه در شب دوم استعلام «پدرخوانده» را می‌گیرد. مدیر بازی چه پاسخی می‌دهد؟",
                options: ["مثبت (مافیا)", "منفی (شهروند)", "بستگی به زره دارد", "هیچکدام"],
                answer: 1, // Index of correct answer
                explanation: "استعلام پدرخوانده (گاد فادر) برای کارآگاه همیشه منفی (شهروند) اعلام می‌شود."
            },
            {
                question: "تک‌تیرانداز به کسی شلیک می‌کند که دکتر دقیقاً همان فرد را نجات داده است. چه اتفاقی می‌افتد؟",
                options: ["فرد از بازی خارج می‌شود", "فرد در بازی می‌ماند", "تک‌تیرانداز خارج می‌شود", "هر دو خارج می‌شوند"],
                answer: 1,
                explanation: "سیو (نجات) دکتر اولویت دارد. اگر دکتر همان هدف اسنایپر را نجات دهد، تیر اسنایپر بی‌اثر می‌شود."
            },
            {
                question: "اگر «جان‌سخت» در شب استعلام وضعیت بگیرد و ۲ نفر از بازی خارج شده باشند، مدیر چه می‌گوید؟",
                options: ["عدد ۲ را اعلام می‌کند", "کسانی که خارج شدند را معرفی می‌کند", "نقش‌های خارج شده را می‌گوید", "فقط تعداد شهروندان را می‌گوید"],
                answer: 2,
                explanation: "جان‌سخت می‌تواند استعلام بگیرد تا بفهمد چه نقش‌هایی (نه چه افرادی) از بازی خارج شده‌اند."
            },
            {
                question: "مافیا در روز به یک شهروند اتهام می‌زند. بهترین واکنش شهروند هوشمند چیست؟",
                options: ["سکوت کردن", "اتهام متقابل بدون دلیل", "درخواست فکت و استدلال", "قسم خوردن"],
                answer: 2,
                explanation: "در بازی مافیا، استدلال و فکت (Fact) مهم‌ترین سلاح شهروند است. قسم خوردن ممنوع و اتهام بیهوده مشکوک است."
            },
            {
                question: "حرفه‌ای (اسنایپر) به اشتباه به یک شهروند شلیک می‌کند. نتیجه چیست؟",
                options: ["شهروند خارج می‌شود", "حرفه‌ای خارج می‌شود", "هر دو خارج می‌شوند", "هیچکس خارج نمی‌شود"],
                answer: 1,
                explanation: "اگر حرفه‌ای (تک‌تیرانداز) به شهروند شلیک کند، خود حرفه‌ای از بازی خارج می‌شود (تیر به خود)."
            }
        ];

        const MIND_SENTENCES = [
            "سکوت همیشه علامت رضایت نیست",
            "شهروند آگاه هرگز نمی‌خوابد",
            "پدرخوانده همیشه در سایه است",
            "مافیا با تفرقه پیروز می‌شود",
            "حقیقت تلخ بهتر از دروغ شیرین است",
            "کارآگاه هوشمند فریب نمی‌خورد"
        ];

        // --- UI MANAGER ---
        const UI = {
            screens: document.querySelectorAll('.screen'),
            
            showScreen(id) {
                this.screens.forEach(s => s.classList.remove('active'));
                document.getElementById(`screen-${id}`).classList.add('active');
            },

            showModal(type, data = null) {
                const overlay = document.getElementById('modal-overlay');
                const content = document.getElementById('modal-content');
                const box = document.getElementById('modal-box');
                
                overlay.classList.add('open');
                box.style.transform = 'scale(1)';

                if (type === 'about') {
                    content.innerHTML = `
                        <h3 class="text-xl font-bold text-[var(--accent-gold)] mb-2">تیم توسعه</h3>
                        <p class="text-sm leading-6">طراحی و پیاده‌سازی شده با ❤️ برای دوستداران مافیا.<br>نسخه: 2.0 Pro</p>
                    `;
                } else if (type === 'gameover') {
                    content.innerHTML = `
                        <i class="fas fa-flag-checkered text-4xl text-[var(--accent-gold)] mb-3"></i>
                        <h3 class="text-xl font-bold mb-2">پایان بازی</h3>
                        <p>${data}</p>
                        <button onclick="Game.goToMenu()" class="btn-gold w-full mt-4">بازگشت به منو</button>
                    `;
                    // Hide the close button in this specific case via JS logic if needed, 
                    // but for simplicity we keep the close button or override onclick
                    document.querySelector('#modal-box button.btn-outline').classList.add('hidden');
                }
            },

            closeModal() {
                const overlay = document.getElementById('modal-overlay');
                const box = document.getElementById('modal-box');
                box.style.transform = 'scale(0.95)';
                overlay.classList.remove('open');
                setTimeout(() => {
                    document.querySelector('#modal-box button.btn-outline').classList.remove('hidden');
                }, 300);
            },

            showToast(msg) {
                const toast = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                toast.style.opacity = '1';
                toast.style.bottom = '50px';
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.bottom = '10px';
                }, 2000);
            }
        };

        // --- GAME LOGIC MANAGER ---
        const Game = {
            state: {
                mode: null, // 'quiz' or 'mind'
                stage: 0,
                score: 0,
                timer: null,
                isBusy: false
            },

            init() {
                // Background Particles Init
                const container = document.getElementById('particles');
                for(let i=0; i<20; i++) {
                    const p = document.createElement('div');
                    p.className = 'particle';
                    p.style.left = Math.random() * 100 + '%';
                    p.style.width = p.style.height = (Math.random() * 5 + 2) + 'px';
                    p.style.animationDuration = (Math.random() * 10 + 10) + 's';
                    p.style.animationDelay = (Math.random() * 5) + 's';
                    container.appendChild(p);
                }

                // Simulated Loading
                let progress = 0;
                const bar = document.getElementById('loading-bar');
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if(progress > 100) progress = 100;
                    bar.style.width = `${progress}%`;
                    
                    if(progress === 100) {
                        clearInterval(interval);
                        setTimeout(() => UI.showScreen('menu'), 500);
                    }
                }, 300);
            },

            startMode(mode) {
                this.state.mode = mode;
                this.state.stage = 0;
                this.state.score = 0;
                this.state.isBusy = false;

                if (mode === 'quiz') {
                    UI.showScreen('quiz');
                    this.loadQuizStage();
                } else if (mode === 'mind') {
                    UI.showScreen('mind');
                    document.getElementById('mind-score').innerText = '0';
                    this.loadMindStage();
                }
            },

            // --- QUIZ LOGIC ---
            loadQuizStage() {
                if (this.state.stage >= QUIZ_DATA.length) {
                    UI.showModal('gameover', 'تبریک! شما به تمام پرونده‌ها مسلط شدید.');
                    return;
                }

                const data = QUIZ_DATA[this.state.stage];
                document.getElementById('quiz-stage').innerText = this.state.stage + 1;
                document.getElementById('quiz-question').innerText = data.question;
                
                const optionsContainer = document.getElementById('quiz-options');
                optionsContainer.innerHTML = '';
                
                data.options.forEach((opt, index) => {
                    const btn = document.createElement('div');
                    btn.className = 'option-card';
                    btn.innerHTML = `<span class="bg-slate-700 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold">${index+1}</span> ${opt}`;
                    btn.onclick = () => this.handleQuizAnswer(index, btn);
                    optionsContainer.appendChild(btn);
                });

                this.startTimer(20, () => this.handleQuizAnswer(-1, null));
            },

            handleQuizAnswer(selectedIndex, btnElement) {
                if (this.state.isBusy) return;
                this.state.isBusy = true;
                clearInterval(this.state.timer);

                const data = QUIZ_DATA[this.state.stage];
                const isCorrect = selectedIndex === data.answer;
                const options = document.querySelectorAll('.option-card');

                // Reveal logic
                options.forEach((opt, idx) => {
                    opt.style.pointerEvents = 'none'; // Disable clicks
                    if (idx === data.answer) opt.classList.add('correct');
                    else if (idx === selectedIndex) opt.classList.add('wrong');
                    else opt.style.opacity = '0.5';
                });

                if (selectedIndex === -1) {
                     UI.showToast('زمان تمام شد!');
                } else if (isCorrect) {
                     UI.showToast('پاسخ صحیح است');
                } else {
                     UI.showToast('اشتباه کردید!');
                }

                // Show Explanation via Toast or wait
                setTimeout(() => {
                    this.state.stage++;
                    this.state.isBusy = false;
                    this.loadQuizStage();
                }, 2500);
            },

            startTimer(seconds, onComplete) {
                clearInterval(this.state.timer);
                const timerDisplay = document.getElementById('quiz-timer');
                let timeLeft = seconds;
                timerDisplay.innerText = timeLeft;
                timerDisplay.style.color = 'var(--accent-gold)';

                this.state.timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.innerText = timeLeft;
                    if (timeLeft <= 5) timerDisplay.style.color = 'var(--accent-red)';
                    
                    if (timeLeft <= 0) {
                        clearInterval(this.state.timer);
                        onComplete();
                    }
                }, 1000);
            },

            // --- MIND GAME LOGIC ---
            loadMindStage() {
                if (this.state.stage >= MIND_SENTENCES.length) {
                    UI.showModal('gameover', `امتیاز نهایی: ${this.state.score}`);
                    return;
                }

                const sentence = MIND_SENTENCES[this.state.stage];
                const displayArea = document.getElementById('mind-text');
                const inputArea = document.getElementById('mind-input-area');
                const input = document.getElementById('mind-input');
                const instruction = document.getElementById('mind-instruction');
                const feedback = document.getElementById('mind-feedback');

                // Reset UI
                inputArea.classList.add('hidden');
                input.value = '';
                feedback.innerText = '';
                displayArea.style.opacity = '0';
                displayArea.style.filter = 'blur(10px)';
                instruction.innerText = `مرحله ${this.state.stage + 1}: آماده‌اید؟`;
                
                setTimeout(() => {
                    // Show Text
                    instruction.innerText = 'به خاطر بسپارید!';
                    displayArea.innerText = sentence;
                    displayArea.style.opacity = '1';
                    displayArea.style.filter = 'blur(0px)';
                    
                    // Duration based on length
                    const duration = Math.max(3000, sentence.length * 150);
                    
                    setTimeout(() => {
                        // Hide Text & Show Input
                        displayArea.style.opacity = '0';
                        displayArea.style.filter = 'blur(20px)';
                        
                        setTimeout(() => {
                             displayArea.innerText = ''; // Clear for security
                             instruction.innerText = 'حالا بنویسید:';
                             inputArea.classList.remove('hidden');
                             input.focus();
                        }, 500);

                    }, duration);

                }, 1000);
            },

            checkMindInput() {
                const input = document.getElementById('mind-input');
                const feedback = document.getElementById('mind-feedback');
                const correctText = MIND_SENTENCES[this.state.stage];
                
                // Normalizing text (ignoring extra spaces or simple arabic/persian differences usually helps, but keeping strict for now)
                if (input.value.trim() === correctText) {
                    this.state.score += 10;
                    document.getElementById('mind-score').innerText = this.state.score;
                    feedback.innerText = '✅ رمز تایید شد';
                    feedback.style.color = 'var(--accent-green)';
                    input.classList.add('border-green-500');
                } else {
                    feedback.innerText = '❌ رمز نامعتبر';
                    feedback.style.color = 'var(--accent-red)';
                    input.classList.add('border-red-500');
                }

                setTimeout(() => {
                    input.classList.remove('border-green-500', 'border-red-500');
                    this.state.stage++;
                    this.loadMindStage();
                }, 2000);
            },

            quit() {
                clearInterval(this.state.timer);
                UI.showScreen('menu');
            },
            
            goToMenu() {
                UI.closeModal();
                this.quit();
            }
        };

        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            Game.init();

            // Mind Game Enter Key
            document.getElementById('mind-input').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') Game.checkMindInput();
            });
            document.getElementById('mind-submit').addEventListener('click', () => Game.checkMindInput());
        });

    </script>
</body>
</html>
