<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازی مافیا (شبیه‌سازی Unity)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* (همان استایل‌های قبلی + تغییرات زیر) */
        body {
            /* ... */
            overflow: hidden; /* جلوگیری از اسکرول */
        }

        /* HUD style */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 20px;
        }

        #health-bar {
            width: 200px;
            height: 20px;
            background-color: #333;
            border: 1px solid #c49730;
        }

        #health {
            background-color: green;
            height: 100%;
            width: 100%;
        }

        /* Game Over screen */
        #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100; /* Make sure it's on top */
        }

        #game-over-screen.active {
            display: flex; /* Show game over screen */
        }

        #game-over-screen h2 {
            font-size: 3rem;
            color: red;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="mafia-animated-bg"></div>

    <!-- HUD (Head-Up Display) -->
    <div id="hud">
        <div id="health-bar">
            <div id="health"></div>
        </div>
        <div id="score">امتیاز: 0</div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen">
        <h2>Game Over</h2>
        <p>Your Score: <span id="final-score">0</span></p>
        <button id="restart-btn" class="btn-mafia">Restart</button>
    </div>

    <div id="game-screen" class="screen active">
        <div class="screen-content-wrapper justify-center">
            <p id="game-message" class="text-xl sm:text-2xl font-semibold text-center text-[#c49730]"></p>
            <button id="action-btn" class="btn-mafia mt-4">انجام عمل</button>
        </div>
    </div>

    <script>
        // --- Game State ---
        let gameState = {
            score: 0,
            health: 100,
            isGameOver: false,
            gameMessage: "",
            currentState: "GAME", // MENU, GAME, GAME_OVER
        };

        // --- DOM Elements ---
        const health = document.getElementById("health");
        const score = document.getElementById("score");
        const gameOverScreen = document.getElementById("game-over-screen");
        const finalScore = document.getElementById("final-score");
        const restartBtn = document.getElementById("restart-btn");
        const gameScreen = document.getElementById("game-screen");
        const gameMessage = document.getElementById("game-message");
        const actionBtn = document.getElementById("action-btn");

        // --- Game Functions ---

        function updateHealthBar() {
            health.style.width = `${gameState.health}%`;
        }

        function updateScore() {
            score.textContent = `امتیاز: ${gameState.score}`;
        }

        function showGameOverScreen() {
            gameState.currentState = "GAME_OVER";
            finalScore.textContent = gameState.score;
            gameOverScreen.classList.add("active");
        }

        function resetGame() {
            gameState.score = 0;
            gameState.health = 100;
            gameState.isGameOver = false;
            gameState.gameMessage = "";
            gameState.currentState = "GAME";

            gameOverScreen.classList.remove("active");
            updateHealthBar();
            updateScore();
            updateGameMessage();
        }

        function updateGameMessage() {
            gameMessage.textContent = gameState.gameMessage;
        }

        function takeDamage(damage) {
            if (gameState.currentState !== "GAME") return;
            gameState.health -= damage;

            if (gameState.health <= 0) {
                gameState.health = 0;
                gameState.isGameOver = true;
                gameState.gameMessage = "شما شکست خوردید!";
                updateGameMessage();
                updateHealthBar();
                setTimeout(showGameOverScreen, 1000);
            }
            updateHealthBar();
        }

        function addScore(points) {
            if (gameState.currentState !== "GAME") return;
            gameState.score += points;
            updateScore();
        }

        function performAction() {
            if (gameState.currentState !== "GAME") return;
            // Simulate some game action: 50% chance of gaining points, 50% chance of taking damage
            const random = Math.random();

            if (random < 0.5) {
                addScore(10);
                gameState.gameMessage = "شما امتیاز گرفتید!";
            } else {
                takeDamage(10);
                gameState.gameMessage = "شما آسیب دیدید!";
            }

            updateGameMessage();

             // Clear the message after a short delay
            setTimeout(() => {
                gameState.gameMessage = "";
                updateGameMessage();
            }, 2000);
        }

        // --- Event Listeners ---
        restartBtn.addEventListener("click", resetGame);
        actionBtn.addEventListener("click", performAction);

        // --- Game Loop (Simplified) ---
        function gameLoop() {
            // (در اینجا منطق اصلی بازی قرار می‌گیرد - بروزرسانی وضعیت، بررسی رویدادها، و غیره)

            // Example: Slowly regenerate health
            if (gameState.health < 100 && gameState.currentState === "GAME") {
                gameState.health += 0.1;
                if (gameState.health > 100) gameState.health = 100;
                updateHealthBar();
            }

            requestAnimationFrame(gameLoop); // Run this function again on the next animation frame
        }

        // --- Initialization ---
        function initializeGame() {
            console.log("Game Initialized.");
            // (می‌توانیم در اینجا تنظیمات اولیه را انجام دهیم)
            resetGame();
            gameLoop(); // Start the game loop
        }

        initializeGame();
    </script>
</body>
</html>