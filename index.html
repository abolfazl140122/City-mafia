<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§ - Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- CORE THEME VARIABLES --- */
        :root {
            --clash-blue-dark: #2c4a7a;
            --clash-blue-light: #4a78b8;
            --clash-gold: #ffd700;
            --clash-gold-dark: #d4af37;
            --clash-brown-dark: #4a2f20;
            --clash-text-light: #f5f5f5;
            --clash-text-dark: #1e1e1e;
            --clash-green: #4caf50;
            --clash-red: #f44336;
            --clash-panel-bg: #3a5b8a;
            --clash-panel-border: #7da8e8;
            --clash-panel-border-dark: #1e3a5e;
        }

        /* --- ANIMATIONS --- */
        @keyframes clash-panel-intro {
            0% { opacity: 0; transform: scale(0.95) translateY(-20px); }
            60% { opacity: 1; transform: scale(1.02) translateY(0); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes breathe-glow {
            0%, 100% { transform: scale(1); box-shadow: 0 6px 12px rgba(255, 215, 0, 0.3); }
            50% { transform: scale(1.03); box-shadow: 0 10px 20px rgba(255, 215, 0, 0.6); }
        }
        @keyframes background-drift {
            0% { background-position: 0% 0%; }
            100% { background-position: 150% 150%; }
        }
        @keyframes spin-smooth {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeInBounce {
            0% { opacity: 0; transform: translateY(-50px); }
            60% { opacity: 1; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes fall-smooth-fade {
            0% { transform: translateY(-150%); opacity: 0; }
            20% { transform: translateY(0); opacity: 1; }
            80% { transform: translateY(120px); opacity: 1; }
            100% { transform: translateY(180px); opacity: 0; }
        }

        /* --- GENERAL STYLES --- */
        body {
            font-family: 'Vazirmatn', sans-serif;
            color: var(--clash-text-light);
            background-color: #162447;
            background-image: url('https://www.transparenttextures.com/patterns/dark-wood.png');
            overflow: hidden;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
            position: relative;
            user-select: none;
        }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 300%; height: 300%;
            background-image: url('https://www.transparenttextures.com/patterns/noise.png');
            opacity: 0.1; z-index: -1; animation: background-drift 180s linear infinite;
        }

        .clash-font { font-family: 'Lilita One', cursive; letter-spacing: 1px; }

        /* --- UI COMPONENTS --- */
        .panel-clash {
            background-color: var(--clash-panel-bg);
            border: 5px solid var(--clash-panel-border-dark);
            border-top-color: var(--clash-panel-border);
            border-left-color: var(--clash-panel-border);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 3px 6px rgba(255, 255, 255, 0.15);
            position: relative;
        }
        .panel-clash::before, .panel-clash::after {
            content: ''; position: absolute; width: 16px; height: 16px;
            background: var(--clash-gold); border-radius: 50%;
            border: 3px solid var(--clash-brown-dark); box-shadow: 0 0 5px #000;
        }
        .panel-clash::before { top: 12px; left: 12px; }
        .panel-clash::after { top: 12px; right: 12px; }

        .panel-hidden { opacity: 0; transform: scale(0.95) translateY(-30px); pointer-events: none; visibility: hidden; transition: all 0.3s ease; }
        .panel-visible { opacity: 1; transform: scale(1) translateY(0); visibility: visible; animation: clash-panel-intro 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }

        .btn-clash {
            border-radius: 16px; font-weight: 900; text-transform: uppercase;
            transition: all 0.2s ease-out; cursor: pointer; position: relative;
            display: inline-flex; align-items: center; justify-content: center;
            color: var(--clash-text-dark); text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
        }
        .btn-clash:disabled { filter: grayscale(90%); cursor: not-allowed; box-shadow: 0 5px 0 #444 !important; transform: translateY(0) !important; }

        .btn-clash-primary {
            background: linear-gradient(to bottom, #ffeb99, var(--clash-gold));
            border: 3px solid var(--clash-brown-dark); box-shadow: 0 8px 0 #b8860b;
            padding: 12px 28px; font-size: 1.2rem;
        }
        .btn-clash-primary:hover { background: linear-gradient(to bottom, #fff5cc, #ffcc00); transform: translateY(-3px); box-shadow: 0 11px 0 #b8860b; }
        .btn-clash-primary:active { transform: translateY(5px) !important; box-shadow: 0 3px 0 #b8860b !important; }

        .btn-clash-secondary {
            background: linear-gradient(to bottom, #8ab6f2, var(--clash-blue-light));
            border: 3px solid var(--clash-panel-border-dark); box-shadow: 0 6px 0 #1e3a5e;
            padding: 10px 20px; font-size: 1rem; color: var(--clash-text-light); text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        .btn-clash-secondary:hover { background: linear-gradient(to bottom, #a8c9ff, #7a98d8); transform: translateY(-3px); box-shadow: 0 9px 0 #1e3a5e; }
        .btn-clash-secondary:active { transform: translateY(4px) !important; box-shadow: 0 2px 0 #1e3a5e !important; }

        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100vh;
            padding: 12px; box-sizing: border-box; opacity: 0; visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            display: flex; flex-direction: column; align-items: center; overflow-y: auto; z-index: 1;
        }
        .screen.active { opacity: 1; visibility: visible; position: relative; z-index: 10; }
        #loading-screen { justify-content: center; background: radial-gradient(circle, rgba(30,58,94,0.6) 0%, rgba(22,36,71,0.9) 70%); position: fixed; z-index: 999; }
        
        .screen-content-wrapper { width: 100%; max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; flex-grow: 1; }

        /* Specific Component Styles */
        .option-btn {
            background: linear-gradient(to bottom, #8ab6f2, #4a78b8); border: 3px solid #1e3a5e;
            box-shadow: 0 5px 0 #1e3a5e; color: white; transition: all 0.2s ease;
            font-size: 1.1rem; padding: 14px; border-radius: 16px; font-weight: bold;
        }
        .option-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 8px 0 #1e3a5e; }
        .option-btn.correct { background: linear-gradient(to bottom, #81c784, var(--clash-green)) !important; border-color: #2e7d32; }
        .option-btn.incorrect { background: linear-gradient(to bottom, #e57373, var(--clash-red)) !important; border-color: #c62828; }

        /* Online & Strategy Specifics */
        .strategy-card {
            background: rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 15px; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: space-between;
        }
        .strategy-card:hover { background: rgba(0,0,0,0.5); border-color: var(--clash-gold); }
        
        .player-avatar {
            width: 50px; height: 50px; border-radius: 50%; background: #4a2f20;
            border: 2px solid var(--clash-gold); display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: #fff;
        }
        
        .role-card {
            width: 120px; height: 160px; background: #fff; color: #000;
            border-radius: 10px; display: flex; flex-direction: column; align-items: center;
            justify-content: center; border: 4px solid var(--clash-brown-dark);
            box-shadow: 0 5px 10px rgba(0,0,0,0.5); animation: clash-panel-intro 0.5s;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--clash-blue-dark); }
        ::-webkit-scrollbar-thumb { background: var(--clash-gold); border-radius: 5px; }

        /* Utility */
        .close-btn-corner {
            position: absolute; top: 10px; right: 10px; width: 40px; height: 40px;
            background: var(--clash-red); border: 2px solid #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            font-weight: bold; font-size: 1.2rem; box-shadow: 0 4px 0 #900;
        }
        .close-btn-corner:active { transform: translateY(3px); box-shadow: 0 1px 0 #900; }
    </style>
</head>
<body>

    <!-- LOADING SCREEN -->
    <div id="loading-screen" class="screen active">
        <div class="flex flex-col items-center justify-center text-center w-full max-w-lg px-4">
            <h1 class="text-5xl sm:text-7xl font-bold clash-font text-[var(--clash-gold)] mb-4" style="text-shadow: 4px 4px 0px var(--clash-brown-dark);">Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§</h1>
            <p class="text-xl mb-8 text-gray-300">Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ…</p>
            <div class="w-full bg-[#1e3a5e] border-4 border-[#2c4a7a] rounded-xl p-1 mb-4">
                <div id="loading-progress-bar-fill" class="h-5 bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-lg w-0 transition-all duration-300 shadow-[0_0_10px_#ffd700]"></div>
            </div>
            <p id="loading-message" class="text-lg font-bold min-h-[30px]">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</p>
        </div>
    </div>

    <!-- MAIN MENU -->
    <div id="main-screen" class="screen">
        <div class="screen-content-wrapper justify-between py-6 min-h-screen">
            <!-- Header -->
            <div class="w-full bg-[#5d4037] border-b-[6px] border-[#3e2723] rounded-2xl p-4 mb-8 shadow-xl text-center relative z-10 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]">
                <h1 class="text-5xl sm:text-7xl clash-font text-[var(--clash-gold)] drop-shadow-[0_4px_0_#000]">Ø´Ù‡Ø± Ù…Ø§ÙÛŒØ§</h1>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col items-center w-full gap-4 mt-auto mb-10 px-4">
                <button id="start-game-btn" class="btn-clash btn-clash-primary clash-font py-4 px-12 text-2xl w-full max-w-sm animate-[breathe-glow_3s_infinite]">Ø´Ø±ÙˆØ¹ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ</button>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-lg mt-4">
                    <button id="online-game-btn" class="btn-clash btn-clash-secondary clash-font py-3 text-lg">
                        âš”ï¸ Ù†Ø¨Ø±Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†
                    </button>
                    <button id="challenge-btn" class="btn-clash btn-clash-secondary clash-font py-3 text-lg">
                        ğŸ§© Ù…Ø¹Ù…Ø§Ù‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
                    </button>
                    <button id="coordination-btn" class="btn-clash btn-clash-secondary clash-font py-3 text-lg">
                        ğŸ“š Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§
                    </button>
                    <button id="developers-btn" class="btn-clash btn-clash-secondary clash-font py-3 text-lg">
                        ğŸ‘¥ Ø³Ø§Ø²Ù†Ø¯Ú¯Ø§Ù†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME MODE PANEL (Popup) -->
    <div id="game-mode-panel-container" class="fixed inset-0 bg-black/90 flex items-center justify-center p-4 panel-hidden z-50">
        <div class="panel-clash p-8 w-full max-w-md text-center relative">
            <button id="close-game-mode-panel-btn" class="close-btn-corner">âœ•</button>
            <h3 class="text-3xl font-bold mb-8 text-[var(--clash-gold)]">Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒ</h3>
            <div class="flex flex-col gap-4">
                <button id="mafia-mode-btn" class="btn-clash btn-clash-primary py-4 text-xl">Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ø§ÙÛŒØ§ (Ø³ÙˆØ§Ù„Ø§Øª)</button>
                <button id="mind-game-mode-btn" class="btn-clash btn-clash-secondary py-4 text-xl">Ú†Ø§Ù„Ø´ Ø°Ù‡Ù† (Ø­Ø§ÙØ¸Ù‡)</button>
            </div>
        </div>
    </div>

    <!-- 1. MAFIA QUIZ SCREEN -->
    <div id="game-screen" class="screen">
        <div class="screen-content-wrapper justify-start pt-6">
            <div class="flex justify-between items-center mb-6 p-4 bg-black/40 rounded-xl w-full">
                <button class="btn-clash btn-clash-secondary text-sm px-4 py-2 back-to-main">Ø®Ø±ÙˆØ¬</button>
                <div class="font-bold text-xl">Ù…Ø±Ø­Ù„Ù‡ <span id="stage-display" class="text-[var(--clash-gold)] text-2xl">1</span></div>
                <div class="relative w-16 h-16 flex items-center justify-center">
                    <svg class="absolute transform -rotate-90" width="60" height="60">
                        <circle cx="30" cy="30" r="26" stroke="#1e3a5e" stroke-width="6" fill="none"></circle>
                        <circle id="timer-progress-circle" cx="30" cy="30" r="26" stroke="#ffd700" stroke-width="6" fill="none" stroke-dasharray="163" stroke-dashoffset="0" class="transition-all duration-1000"></circle>
                    </svg>
                    <span id="timer-text" class="font-bold text-xl">25</span>
                </div>
            </div>
            
            <div class="panel-clash p-6 w-full min-h-[300px] flex flex-col justify-center items-center text-center">
                <p id="question-text" class="text-2xl font-bold leading-relaxed mb-8">Ø³ÙˆØ§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯...</p>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full"></div>
                <div id="question-explanation" class="hidden mt-6 bg-black/30 p-4 rounded-lg text-sm text-yellow-100 border border-white/10"></div>
            </div>
            <div id="game-feedback" class="text-center text-2xl font-bold mt-4 h-8 clash-font"></div>
        </div>
    </div>

    <!-- 2. MIND GAME SCREEN -->
    <div id="mind-game-screen" class="screen">
        <div class="screen-content-wrapper justify-start pt-6">
            <div class="flex justify-between items-center mb-6 p-4 bg-black/40 rounded-xl w-full">
                <button class="btn-clash btn-clash-secondary text-sm px-4 py-2 back-to-main">Ø®Ø±ÙˆØ¬</button>
                <div class="font-bold">Ø§Ù…ØªÛŒØ§Ø²: <span id="mind-game-score" class="text-[var(--clash-gold)] text-2xl">0</span></div>
            </div>
            <div class="panel-clash p-8 w-full text-center min-h-[400px] flex flex-col items-center justify-center">
                <h2 id="mind-instruction" class="text-3xl font-bold mb-6 text-[var(--clash-gold)]">Ø±Ù…Ø² Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø±!</h2>
                
                <div id="falling-container" class="h-32 flex items-center justify-center w-full overflow-hidden mb-6 relative"></div>
                
                <div id="mind-input-area" class="w-full max-w-sm hidden">
                    <input type="text" id="mind-input" class="w-full bg-[#1e3a5e] border-2 border-[#4a78b8] rounded-xl p-3 text-center text-xl text-white mb-4 outline-none focus:border-[#ffd700]" placeholder="Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." dir="rtl">
                    <button id="mind-submit-btn" class="btn-clash btn-clash-primary w-full py-3">Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø²</button>
                </div>
                <div id="mind-feedback" class="h-8 text-xl font-bold mt-4"></div>
            </div>
        </div>
    </div>

    <!-- 3. ONLINE BATTLE SIMULATOR (New Feature) -->
    <div id="online-screen" class="screen">
        <div class="screen-content-wrapper justify-start pt-6">
            <div class="flex justify-between items-center mb-4">
                <button class="btn-clash btn-clash-secondary text-sm px-4 py-2 back-to-main">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„Ø§Ø¨ÛŒ</button>
                <h2 class="text-xl font-bold text-[var(--clash-gold)]">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ù†Ø¨Ø±Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
            </div>

            <!-- Stage 1: Matchmaking -->
            <div id="online-matchmaking" class="panel-clash p-10 text-center flex flex-col items-center">
                <div class="w-16 h-16 border-4 border-t-[var(--clash-gold)] border-[#2c4a7a] rounded-full animate-spin mb-6"></div>
                <h3 class="text-2xl font-bold mb-2">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†...</h3>
                <p class="text-gray-300 text-sm">Ø³Ø±ÙˆØ±: ØªÙ‡Ø±Ø§Ù† (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡)</p>
            </div>

            <!-- Stage 2: Role Reveal -->
            <div id="online-role-reveal" class="panel-clash p-10 text-center flex-col items-center hidden">
                <h3 class="text-2xl font-bold mb-6">Ù†Ù‚Ø´ Ø´Ù…Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒ:</h3>
                <div id="my-role-card" class="role-card w-40 h-56 mx-auto mb-6 bg-yellow-100 border-8 border-[#4a2f20]">
                    <span class="text-4xl mb-2">ğŸ•µï¸â€â™‚ï¸</span>
                    <span id="role-name" class="text-xl font-black text-black">Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡</span>
                </div>
                <p id="role-desc" class="mb-6 text-sm">Ø´Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ù‡Ø± Ø´Ø¨ Ø§Ø³ØªØ¹Ù„Ø§Ù… ÛŒÚ©ÛŒ Ø§Ø² Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø±Ø§ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
                <button id="start-night-btn" class="btn-clash btn-clash-primary w-full max-w-xs">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ ÙØ§Ø² Ø´Ø¨</button>
            </div>

            <!-- Stage 3: Night Action -->
            <div id="online-action" class="panel-clash p-6 flex-col hidden">
                <h3 class="text-center text-xl font-bold mb-4 text-[#8ab6f2]">Ù‡Ø¯Ù Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</h3>
                <div id="players-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-6">
                    <!-- Players injected via JS -->
                </div>
                <div id="action-log" class="bg-black/40 p-3 rounded h-20 overflow-y-auto text-xs font-mono text-green-400 mb-2">
                    > Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø§ØªØ§Ù‚ Ø¨Ø§Ø²ÛŒ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯...<br>
                    > Ø´Ø¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯...
                </div>
            </div>

            <!-- Stage 4: Result -->
            <div id="online-result" class="panel-clash p-8 text-center hidden flex-col items-center">
                <div id="result-icon" class="text-6xl mb-4">âš–ï¸</div>
                <h3 id="result-title" class="text-3xl font-bold mb-4">Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§Ø²ÛŒ</h3>
                <p id="result-message" class="text-lg mb-6 leading-relaxed"></p>
                <button class="btn-clash btn-clash-primary" onclick="resetOnlineGame()">Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø¬Ø¯Ø¯</button>
            </div>
        </div>
    </div>

    <!-- 4. SPECIAL CHALLENGE (Logic Puzzle) -->
    <div id="challenge-screen" class="screen">
        <div class="screen-content-wrapper justify-start pt-6">
            <div class="flex justify-between items-center mb-4">
                <button class="btn-clash btn-clash-secondary text-sm px-4 py-2 back-to-main">Ø®Ø±ÙˆØ¬</button>
                <h2 class="text-xl font-bold text-[var(--clash-gold)]">Ù…Ø¹Ù…Ø§ÛŒ Ø§ØªØ§Ù‚ Ø¨Ø§Ø²Ø¬ÙˆÛŒÛŒ</h2>
            </div>
            
            <div class="panel-clash p-6 relative">
                <div class="bg-black/30 p-4 rounded-xl mb-6 border border-white/10">
                    <p class="leading-relaxed text-lg">
                        <span class="text-[var(--clash-gold)] font-bold">Ù¾Ø±ÙˆÙ†Ø¯Ù‡:</span> 
                        Ø³Ù‡ Ù†ÙØ± Ø¯Ø³ØªÚ¯ÛŒØ± Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. ÙÙ‚Ø· <span class="text-red-400 font-bold">ÛŒÚ© Ù†ÙØ±</span> Ø§Ø² Ø¢Ù†â€ŒÙ‡Ø§ Ù…Ø§ÙÛŒØ§ Ø§Ø³Øª Ùˆ Ø¯Ø±ÙˆØº Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯. Ø¯Ùˆ Ù†ÙØ± Ø¯ÛŒÚ¯Ø± Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø±Ø§Ø³Øª Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÙ†Ø¯. Ù…Ø§ÙÛŒØ§ Ú©ÛŒØ³ØªØŸ
                    </p>
                </div>

                <div class="space-y-4 mb-8">
                    <div class="bg-[#2c4a7a] p-4 rounded-lg flex items-center border border-[#4a78b8]">
                        <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-black font-bold ml-3">1</div>
                        <div><span class="font-bold text-yellow-300">Ú©Ø§Ù…Ø±Ø§Ù†:</span> "Ù…Ù† Ù…Ø§ÙÛŒØ§ Ù†ÛŒØ³ØªÙ…."</div>
                    </div>
                    <div class="bg-[#2c4a7a] p-4 rounded-lg flex items-center border border-[#4a78b8]">
                        <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-black font-bold ml-3">2</div>
                        <div><span class="font-bold text-yellow-300">Ø³Ù‡Ø±Ø§Ø¨:</span> "Ù…Ø§ÙÛŒØ§ Ú©Ø§Ù…Ø±Ø§Ù† Ø§Ø³Øª."</div>
                    </div>
                    <div class="bg-[#2c4a7a] p-4 rounded-lg flex items-center border border-[#4a78b8]">
                        <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-black font-bold ml-3">3</div>
                        <div><span class="font-bold text-yellow-300">Ø±Ø¶Ø§:</span> "Ø³Ù‡Ø±Ø§Ø¨ Ø¯Ø±ÙˆØº Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯."</div>
                    </div>
                </div>

                <h3 class="text-center font-bold mb-4">Ù…Ø§ÙÛŒØ§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</h3>
                <div class="grid grid-cols-3 gap-3">
                    <button class="btn-clash btn-clash-secondary challenge-choice" data-target="kamran">Ú©Ø§Ù…Ø±Ø§Ù†</button>
                    <button class="btn-clash btn-clash-secondary challenge-choice" data-target="sohrab">Ø³Ù‡Ø±Ø§Ø¨</button>
                    <button class="btn-clash btn-clash-secondary challenge-choice" data-target="reza">Ø±Ø¶Ø§</button>
                </div>
                <div id="challenge-feedback" class="mt-4 text-center font-bold text-lg min-h-[30px]"></div>
            </div>
        </div>
    </div>

    <!-- 5. STRATEGY WIKI -->
    <div id="strategy-screen" class="screen">
        <div class="screen-content-wrapper justify-start pt-6">
            <div class="flex justify-between items-center mb-4">
                <button class="btn-clash btn-clash-secondary text-sm px-4 py-2 back-to-main">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                <h2 class="text-xl font-bold text-[var(--clash-gold)]">Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ù†Ø´</h2>
            </div>
            
            <div class="grid grid-cols-1 gap-4 pb-10">
                <div class="panel-clash p-5 strategy-card" onclick="openStrategyModal('Ù¾ÙˆØ´Ø´ Ø³ÙÛŒØ¯', 'Ø¯Ø± Ø§ÛŒÙ† ØªÚ©Ù†ÛŒÚ©ØŒ Ù…Ø§ÙÛŒØ§ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø¨Ø§ Ø¯ÙØ§Ø¹ Ø§Ø² Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø³ÙÛŒØ¯ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ØŒ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø´Ù‡Ø± Ø±Ø§ Ø¬Ù„Ø¨ Ú©Ù†Ø¯ ØªØ§ Ø¯Ø± Ù…Ø±Ø§Ø­Ù„ Ù†Ù‡Ø§ÛŒÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´ÙˆØ¯.')">
                    <div>
                        <h3 class="font-bold text-lg text-yellow-300">ØªÚ©Ù†ÛŒÚ© Ù¾ÙˆØ´Ø´ Ø³ÙÛŒØ¯</h3>
                        <p class="text-xs text-gray-300 mt-1">Ø³Ø·Ø­: Ù¾ÛŒØ´Ø±ÙØªÙ‡</p>
                    </div>
                    <span class="text-2xl">ğŸ›¡ï¸</span>
                </div>

                <div class="panel-clash p-5 strategy-card" onclick="openStrategyModal('ØªØ§Ø±Ú¯Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØªÙˆØ¨ÙˆØ³ÛŒ', 'Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ ÛŒÚ© Ù†ÙØ± ØªØ§Ø±Ú¯Øª Ù…ÛŒâ€ŒØ®ÙˆØ±Ø¯ Ùˆ Ø¨Ù‚ÛŒÙ‡ Ø¨Ø¯ÙˆÙ† Ø¯Ù„ÛŒÙ„ Ù…Ù†Ø·Ù‚ÛŒ Ù¾Ø´Øª Ø³Ø± Ø§Ùˆ Ø±Ø§ÛŒ Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯. Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù…Ø§ÙÛŒØ§Ù‡Ø§ Ø³ÙˆØ§Ø± Ù…ÙˆØ¬ Ø§ØªÙˆØ¨ÙˆØ³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.')">
                    <div>
                        <h3 class="font-bold text-lg text-yellow-300">Ù…ÙˆØ¬â€ŒØ³ÙˆØ§Ø±ÛŒ (Ø§ØªÙˆØ¨ÙˆØ³ÛŒ)</h3>
                        <p class="text-xs text-gray-300 mt-1">Ø³Ø·Ø­: Ù…ØªÙˆØ³Ø·</p>
                    </div>
                    <span class="text-2xl">ğŸšŒ</span>
                </div>

                <div class="panel-clash p-5 strategy-card" onclick="openStrategyModal('ØªÙ„Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡', 'Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø²ÛŒØ±Ú© Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ú©ÙˆÚ© Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ù…Ø§ÙÛŒØ§ ÙÚ©Ø± Ú©Ù†Ø¯ Ø§Ùˆ Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡ Ø§Ø³ØªØŒ Ø¯Ø± Ø­Ø§Ù„ÛŒ Ú©Ù‡ Ù†Ù‚Ø´ Ù…Ù‡Ù…â€ŒØªØ±ÛŒ Ø¯Ø§Ø±Ø¯ ÛŒØ§ ÙÙ‚Ø· ÛŒÚ© Ø·Ø¹Ù…Ù‡ Ø§Ø³Øª.')">
                    <div>
                        <h3 class="font-bold text-lg text-yellow-300">ØªÙ„Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ (Baiting)</h3>
                        <p class="text-xs text-gray-300 mt-1">Ø³Ø·Ø­: Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</p>
                    </div>
                    <span class="text-2xl">ğŸª¤</span>
                </div>

                <div class="panel-clash p-5 strategy-card" onclick="openStrategyModal('Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ú©Øª Ø´Ø¨', 'Ù…Ø§ÙÛŒØ§ Ø¨Ø§ÛŒØ¯ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø§Øª Ø´Ø¨ Ø±Ø§ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ú©Ù†Ø¯ ØªØ§ Ù¾Ø²Ø´Ú© Ù†ØªÙˆØ§Ù†Ø¯ Ø³ÛŒÙˆ Ø¯Ù‡Ø¯. Ø²Ø¯Ù† Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ù…â€ŒØ§Ù‡Ù…ÛŒØª Ø¨Ø±Ø§ÛŒ Ú¯ÛŒØ¬ Ú©Ø±Ø¯Ù† Ø´Ù‡Ø± Ú¯Ø§Ù‡ÛŒ Ù…ÙÛŒØ¯ØªØ± Ø§Ø³Øª.')">
                    <div>
                        <h3 class="font-bold text-lg text-yellow-300">Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§Ø² Ø´Ø¨</h3>
                        <p class="text-xs text-gray-300 mt-1">ØªÛŒÙ… Ù…Ø§ÙÛŒØ§</p>
                    </div>
                    <span class="text-2xl">ğŸŒ™</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL (Generic) -->
    <div id="modal-container" class="fixed inset-0 bg-black/90 flex items-center justify-center p-4 panel-hidden z-50">
        <div class="panel-clash p-8 w-full max-w-lg text-center">
            <h3 id="modal-title" class="text-3xl font-bold mb-4 text-[var(--clash-gold)]">Ø¹Ù†ÙˆØ§Ù†</h3>
            <p id="modal-message" class="mb-6 text-lg leading-relaxed text-gray-200">Ù¾ÛŒØ§Ù…</p>
            <div class="flex justify-center gap-4">
                <button id="modal-confirm-btn" class="btn-clash btn-clash-primary">ØªØ§ÛŒÛŒØ¯</button>
                <button id="modal-cancel-btn" class="btn-clash btn-clash-secondary hidden">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>

    <!-- DEVELOPERS PANEL -->
    <div id="developers-panel-container" class="fixed inset-0 bg-black/90 flex items-center justify-center p-4 panel-hidden z-50">
        <div class="panel-clash p-8 w-full max-w-md relative text-center">
            <button id="close-developers-panel-btn" class="close-btn-corner">âœ•</button>
            <h3 class="text-3xl font-bold mb-8 text-[var(--clash-gold)] drop-shadow-md">ØªÛŒÙ… Ø³Ø§Ø²Ù†Ø¯Ù‡</h3>
            
            <div class="bg-[#1e3a5e] p-6 rounded-xl border-2 border-[#4a78b8] mb-6">
                <div class="text-5xl mb-4">ğŸ’</div>
                <h4 class="text-2xl font-bold text-white mb-2">ØªÛŒÙ… ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ…</h4>
                <p class="text-sm text-blue-200 mb-4">Escort Game Development Team</p>
                <hr class="border-blue-400/30 my-4">
                <p class="text-gray-200 leading-relaxed text-sm">
                    Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ Ùˆ Ø¯Ù‚Øª Ø¨Ø±Ø§ÛŒ Ø¹Ø§Ø´Ù‚Ø§Ù† Ù…Ø§ÙÛŒØ§. ØªÙ…Ø§Ù… Ø­Ù‚ÙˆÙ‚ Ø§ÛŒÙ† Ø§Ø«Ø± Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ ØªÛŒÙ… Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ… Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯.
                </p>
            </div>
            
            <div class="flex justify-center gap-2 text-xs text-gray-400">
                <span>Ù†Ø³Ø®Ù‡: 2.0.0 (Ù†Ù‡Ø§ÛŒÛŒ)</span>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const mafiaData = [
            { q: "Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡ Ø§Ú¯Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù¾Ø¯Ø±Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯ Ú†Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ", options: ["Ù…Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯", "Ù…Ù†ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯", "Ù†Ø§Ù…Ø¹Ù„ÙˆÙ…", "Ø®ÙˆØ¯Ø´ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯"], a: "Ù…Ù†ÙÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯", exp: "Ù¾Ø¯Ø±Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø±Ø¦ÛŒØ³ Ù…Ø§ÙÛŒØ§Ø³Øª Ùˆ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡ Ù‡Ù…ÛŒØ´Ù‡ Ù…Ù†ÙÛŒ (Ø´Ù‡Ø±ÙˆÙ†Ø¯) Ù…ÛŒâ€ŒØ¢ÛŒØ¯." },
            { q: "Ù†Ù‚Ø´ Ø¬Ø§Ù†â€ŒØ³Ø®Øª Ø¯Ø± Ø´Ø¨ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŸ", options: ["Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯", "ØªÛŒØ± Ù…ÛŒâ€ŒØ²Ù†Ø¯", "ÛŒÚ© Ø¨Ø§Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù… ØªÛŒØ± Ø´Ø¨ Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯", "Ø§Ø² Ø®ÙˆØ¯ Ø¯ÙØ§Ø¹ Ù…ÛŒâ€ŒÚ©Ù†Ø¯"], a: "ÛŒÚ© Ø¨Ø§Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù… ØªÛŒØ± Ø´Ø¨ Ø±Ø§ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯", exp: "Ø¬Ø§Ù†â€ŒØ³Ø®Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¯Ùˆ Ø¨Ø§Ø± Ø¯Ø± Ø·ÙˆÙ„ Ø¨Ø§Ø²ÛŒ Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙˆØ¶Ø¹ÛŒØª Ú©Ø´ØªÙ‡â€ŒØ´Ø¯Ú¯Ø§Ù† Ø´Ø¨ Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯." },
            { q: "Ø§Ú¯Ø± Ø§Ø³Ù†Ø§ÛŒÙ¾Ø± Ø¨Ù‡ Ù¾Ø²Ø´Ú© Ø´Ù„ÛŒÚ© Ú©Ù†Ø¯ Ú†Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ", options: ["Ù¾Ø²Ø´Ú© Ù…ÛŒâ€ŒÙ…ÛŒØ±Ø¯", "Ø§Ø³Ù†Ø§ÛŒÙ¾Ø± Ù…ÛŒâ€ŒÙ…ÛŒØ±Ø¯", "Ù‡Ø± Ø¯Ùˆ Ù…ÛŒâ€ŒÙ…ÛŒØ±Ù†Ø¯", "Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…"], a: "Ø§Ø³Ù†Ø§ÛŒÙ¾Ø± Ù…ÛŒâ€ŒÙ…ÛŒØ±Ø¯", exp: "Ø§Ú¯Ø± Ø§Ø³Ù†Ø§ÛŒÙ¾Ø± Ø¨Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨Ù‡ ÛŒÚ© Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø´Ù„ÛŒÚ© Ú©Ù†Ø¯ØŒ Ø®ÙˆØ¯Ø´ Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
            { q: "Ø´Ø±Ø· Ù¾ÛŒØ±ÙˆØ²ÛŒ Ù…Ø§ÙÛŒØ§ Ú†ÛŒØ³ØªØŸ", options: ["Ú©Ø´ØªÙ† Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡", "ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù†", "Ù…Ø§Ù†Ø¯Ù† Ù¾Ø¯Ø±Ø®ÙˆØ§Ù†Ø¯Ù‡", "Ø´Ø¨ Ø´Ø¯Ù† Ø¯Ø± Ø±ÙˆØ² Ø³ÙˆÙ…"], a: "ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§Ø¨Ø± Ø¨Ø§ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù†", exp: "Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø§ÙÛŒØ§ Ø¨Ø±Ø§Ø¨Ø± ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø´ÙˆØ¯ØŒ Ø´Ù‡Ø± Ø³Ù‚ÙˆØ· Ù…ÛŒâ€ŒÚ©Ù†Ø¯." }
        ];

        const mindSentences = [
            "Ø³Ú©ÙˆØª Ø¨Ø±Ù‡ Ù‡Ø§",
            "Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø³Ø§Ø¯Ù‡",
            "Ù¾Ø¯Ø±Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯",
            "ØªÛŒØ± Ø®Ù„Ø§Øµ",
            "Ù…Ø°Ø§Ú©Ø±Ù‡ Ù†Ø§Ù…ÙˆÙÙ‚"
        ];

        // --- DOM ELEMENTS ---
        const screens = document.querySelectorAll('.screen');
        const modal = {
            container: document.getElementById('modal-container'),
            title: document.getElementById('modal-title'),
            msg: document.getElementById('modal-message'),
            confirm: document.getElementById('modal-confirm-btn'),
            cancel: document.getElementById('modal-cancel-btn')
        };

        // --- NAVIGATION SYSTEM ---
        function navigateTo(screenId) {
            screens.forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showModal(title, msg, onConfirm, onCancel = null) {
            modal.title.textContent = title;
            modal.msg.textContent = msg;
            modal.confirm.onclick = () => { closeModal(); if(onConfirm) onConfirm(); };
            
            if(onCancel) {
                modal.cancel.classList.remove('hidden');
                modal.cancel.onclick = () => { closeModal(); onCancel(); };
            } else {
                modal.cancel.classList.add('hidden');
            }
            
            modal.container.classList.remove('panel-hidden');
            modal.container.classList.add('panel-visible');
        }

        function closeModal() {
            modal.container.classList.remove('panel-visible');
            modal.container.classList.add('panel-hidden');
        }

        document.querySelectorAll('.back-to-main').forEach(btn => {
            btn.addEventListener('click', () => {
                showModal("Ø¨Ø§Ø²Ú¯Ø´ØªØŸ", "Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯ÛŒØ¯ØŸ", () => navigateTo('main-screen'), () => {});
            });
        });

        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            let progress = 0;
            const bar = document.getElementById('loading-progress-bar-fill');
            const msg = document.getElementById('loading-message');
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if(progress > 100) progress = 100;
                bar.style.width = `${progress}%`;
                
                if(progress < 30) msg.textContent = "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ...";
                else if(progress < 70) msg.textContent = "Ø¨Ø±Ø±Ø³ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† Ø´Ù‡Ø±...";
                else msg.textContent = "Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³Ú©ÙˆØ±Øª Ú¯ÛŒÙ…...";

                if(progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.remove('active');
                        document.getElementById('main-screen').classList.add('active');
                    }, 800);
                }
            }, 300);
        });

        // --- MAFIA QUIZ LOGIC ---
        let quizStage = 0;
        let quizTimer;
        
        document.getElementById('mafia-mode-btn').onclick = () => {
            document.getElementById('game-mode-panel-container').classList.add('panel-hidden');
            document.getElementById('game-mode-panel-container').classList.remove('panel-visible');
            startQuiz();
        };

        function startQuiz() {
            quizStage = 0;
            navigateTo('game-screen');
            loadQuestion();
        }

        function loadQuestion() {
            if(quizStage >= mafiaData.length) {
                showModal("Ù¾Ø§ÛŒØ§Ù† Ø¹Ù…Ù„ÛŒØ§Øª", "ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ù‡ ØªÙ…Ø§Ù… Ø³ÙˆØ§Ù„Ø§Øª Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯ÛŒØ¯.", () => navigateTo('main-screen'));
                return;
            }
            
            const data = mafiaData[quizStage];
            document.getElementById('stage-display').textContent = quizStage + 1;
            document.getElementById('question-text').textContent = data.q;
            document.getElementById('question-explanation').classList.add('hidden');
            document.getElementById('game-feedback').textContent = "";
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            data.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => handleAnswer(opt, btn, data);
                container.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            let time = 25;
            const circle = document.getElementById('timer-progress-circle');
            const text = document.getElementById('timer-text');
            const circumference = 163; // 2 * pi * 26
            
            clearInterval(quizTimer);
            circle.style.strokeDashoffset = 0;
            circle.style.stroke = "#ffd700";
            
            quizTimer = setInterval(() => {
                time--;
                text.textContent = time;
                const offset = circumference - (time / 25) * circumference;
                circle.style.strokeDashoffset = offset;

                if(time < 5) circle.style.stroke = "#f44336";
                if(time <= 0) {
                    clearInterval(quizTimer);
                    handleAnswer(null, null, mafiaData[quizStage]);
                }
            }, 1000);
        }

        function handleAnswer(selected, btn, data) {
            clearInterval(quizTimer);
            const buttons = document.querySelectorAll('#options-container button');
            buttons.forEach(b => b.disabled = true);

            const isCorrect = selected === data.a;
            if(btn) btn.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            // Highlight correct one
            buttons.forEach(b => {
                if(b.textContent === data.a) b.classList.add('correct');
            });

            const fb = document.getElementById('game-feedback');
            fb.textContent = isCorrect ? "Ø¢ÙØ±ÛŒÙ†! Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯" : "Ø§Ø´ØªØ¨Ø§Ù‡ Ø´Ø¯!";
            fb.style.color = isCorrect ? "var(--clash-green)" : "var(--clash-red)";

            const exp = document.getElementById('question-explanation');
            exp.textContent = "Ù†Ú©ØªÙ‡: " + data.exp;
            exp.classList.remove('hidden');

            setTimeout(() => {
                quizStage++;
                loadQuestion();
            }, 4000);
        }

        // --- MIND GAME LOGIC ---
        let mindScore = 0;
        document.getElementById('mind-game-mode-btn').onclick = () => {
            document.getElementById('game-mode-panel-container').classList.add('panel-hidden');
            document.getElementById('game-mode-panel-container').classList.remove('panel-visible');
            startMindGame();
        };

        function startMindGame() {
            mindScore = 0;
            document.getElementById('mind-game-score').textContent = "0";
            navigateTo('mind-game-screen');
            runMindRound(0);
        }

        function runMindRound(idx) {
            if(idx >= mindSentences.length) {
                showModal("Ù¾Ø§ÛŒØ§Ù† Ú†Ø§Ù„Ø´", `Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ: ${mindScore}`, () => navigateTo('main-screen'));
                return;
            }

            const sentence = mindSentences[idx];
            const container = document.getElementById('falling-container');
            const inputArea = document.getElementById('mind-input-area');
            const instruction = document.getElementById('mind-instruction');
            const feedback = document.getElementById('mind-feedback');
            const input = document.getElementById('mind-input');

            container.innerHTML = '';
            inputArea.classList.add('hidden');
            feedback.textContent = '';
            input.value = '';
            instruction.textContent = "Ø¯Ù‚Øª Ú©Ù†!";

            const el = document.createElement('div');
            el.textContent = sentence;
            el.className = 'text-3xl font-bold text-yellow-300 absolute';
            el.style.animation = 'fall-smooth-fade 4s linear forwards';
            container.appendChild(el);

            setTimeout(() => {
                instruction.textContent = "Ú†Ù‡ Ú©Ù„Ù…Ù‡â€ŒØ§ÛŒ Ø¨ÙˆØ¯ØŸ";
                inputArea.classList.remove('hidden');
                input.focus();
                
                document.getElementById('mind-submit-btn').onclick = () => {
                    if(input.value.trim() === sentence) {
                        mindScore++;
                        document.getElementById('mind-game-score').textContent = mindScore;
                        feedback.textContent = "âœ… Ø¹Ø§Ù„ÛŒ!";
                        feedback.style.color = "var(--clash-green)";
                    } else {
                        feedback.textContent = `âŒ Ø§Ø´ØªØ¨Ø§Ù‡! (${sentence})`;
                        feedback.style.color = "var(--clash-red)";
                    }
                    setTimeout(() => runMindRound(idx + 1), 2000);
                };
            }, 4000);
        }

        // --- ONLINE SIMULATOR LOGIC ---
        document.getElementById('online-game-btn').onclick = () => {
            navigateTo('online-screen');
            startMatchmaking();
        };

        function startMatchmaking() {
            document.getElementById('online-matchmaking').classList.remove('hidden');
            document.getElementById('online-matchmaking').classList.add('flex');
            document.getElementById('online-role-reveal').classList.add('hidden');
            document.getElementById('online-action').classList.add('hidden');
            document.getElementById('online-result').classList.add('hidden');

            // Simulate finding a match
            setTimeout(() => {
                document.getElementById('online-matchmaking').classList.add('hidden');
                document.getElementById('online-matchmaking').classList.remove('flex');
                
                // Random Role
                const roles = [
                    { name: "Ø§Ø³Ù†Ø§ÛŒÙ¾Ø±", icon: "ğŸ”«", desc: "ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†. Ø§Ú¯Ø± Ù…Ø§ÙÛŒØ§ Ø¨Ø§Ø´Ø¯ Ù…ÛŒâ€ŒÙ…ÛŒØ±Ø¯." },
                    { name: "Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡", icon: "ğŸ•µï¸â€â™‚ï¸", desc: "Ø§Ø³ØªØ¹Ù„Ø§Ù… ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø¨Ú¯ÛŒØ±." },
                    { name: "Ø¯Ú©ØªØ±", icon: "ğŸ©º", desc: "ÛŒÚ© Ù†ÙØ± Ø±Ø§ Ø§Ø² Ø´Ø§Øª Ø´Ø¨ Ù†Ø¬Ø§Øª Ø¨Ø¯Ù‡." }
                ];
                const myRole = roles[Math.floor(Math.random() * roles.length)];
                
                document.getElementById('role-name').textContent = myRole.name;
                document.getElementById('my-role-card').querySelector('span').textContent = myRole.icon;
                document.getElementById('role-desc').textContent = myRole.desc;
                
                const revealDiv = document.getElementById('online-role-reveal');
                revealDiv.classList.remove('hidden');
                revealDiv.classList.add('flex');
                
                document.getElementById('start-night-btn').onclick = () => startNightPhase(myRole);

            }, 3000);
        }

        function startNightPhase(role) {
            document.getElementById('online-role-reveal').classList.add('hidden');
            document.getElementById('online-role-reveal').classList.remove('flex');
            
            const actionDiv = document.getElementById('online-action');
            actionDiv.classList.remove('hidden');
            actionDiv.classList.add('flex');
            
            const grid = document.getElementById('players-grid');
            grid.innerHTML = '';
            const log = document.getElementById('action-log');

            // Create 6 Fake Players
            for(let i=1; i<=6; i++) {
                const p = document.createElement('div');
                p.className = 'bg-[#1e3a5e] p-3 rounded border border-blue-500 cursor-pointer hover:bg-blue-700 transition flex flex-col items-center';
                p.innerHTML = `<div class="player-avatar mb-2">${i}</div><span class="text-sm font-bold">Ø¨Ø§Ø²ÛŒÚ©Ù† ${i}</span>`;
                p.onclick = () => {
                    log.innerHTML += `> Ù‡Ø¯Ù Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯: Ø¨Ø§Ø²ÛŒÚ©Ù† ${i}<br>`;
                    log.scrollTop = log.scrollHeight;
                    setTimeout(() => resolveNight(role, i), 1000);
                };
                grid.appendChild(p);
            }
        }

        function resolveNight(role, targetId) {
            document.getElementById('online-action').classList.add('hidden');
            document.getElementById('online-action').classList.remove('flex');
            
            const resDiv = document.getElementById('online-result');
            resDiv.classList.remove('hidden');
            resDiv.classList.add('flex');
            
            const msg = document.getElementById('result-message');
            const icon = document.getElementById('result-icon');
            
            // Random outcome simulation
            const success = Math.random() > 0.5;
            
            if (role.name === "Ø§Ø³Ù†Ø§ÛŒÙ¾Ø±") {
                if(success) {
                    icon.textContent = "ğŸ¯";
                    msg.textContent = `Ø´Ù„ÛŒÚ© Ø¯Ù‚ÛŒÙ‚! Ø¨Ø§Ø²ÛŒÚ©Ù† ${targetId} Ù…Ø§ÙÛŒØ§ Ø¨ÙˆØ¯ Ùˆ Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯. Ø´Ù‡Ø± Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯!`;
                    msg.className = "text-green-400 text-lg mb-6";
                } else {
                    icon.textContent = "ğŸ’€";
                    msg.textContent = `Ø§Ø´ØªØ¨Ø§Ù‡ Ú©Ø±Ø¯ÛŒ! Ø¨Ø§Ø²ÛŒÚ©Ù† ${targetId} Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ø¨ÙˆØ¯. Ø´Ù…Ø§ Ø§Ø² Ø¨Ø§Ø²ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯.`;
                    msg.className = "text-red-400 text-lg mb-6";
                }
            } else if (role.name === "Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡") {
                icon.textContent = success ? "ğŸ‘" : "ğŸ‘";
                msg.textContent = success ? `Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† ${targetId}: Ù…Ø§ÙÛŒØ§!` : `Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù† ${targetId}: Ø´Ù‡Ø±ÙˆÙ†Ø¯.`;
            } else {
                icon.textContent = "â¤ï¸";
                msg.textContent = `Ø¨Ø§Ø²ÛŒÚ©Ù† ${targetId} ØªÙˆØ³Ø· Ø´Ù…Ø§ Ø³ÛŒÙˆ Ø´Ø¯ Ùˆ Ø§Ø² Ø´Ø§Øª Ø´Ø¨ Ø¯Ø± Ø§Ù…Ø§Ù† Ù…Ø§Ù†Ø¯.`;
            }
        }

        function resetOnlineGame() {
            startMatchmaking();
        }

        // --- CHALLENGE LOGIC ---
        document.getElementById('challenge-btn').onclick = () => navigateTo('challenge-screen');

        document.querySelectorAll('.challenge-choice').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.target.getAttribute('data-target');
                const fb = document.getElementById('challenge-feedback');
                
                // Logic:
                // Kamran: "I am not Mafia" (True if Citz, False if Mafia)
                // Sohrab: "Kamran is Mafia" (True if Citz, False if Mafia)
                // Reza: "Sohrab is lying" (True if Citz, False if Mafia)
                
                // If Kamran Mafia: K(Lie->"I am Mafia"), S(True->"Kamran Mafia"), R(True->"Sohrab True").
                //    Kamran says "I not Mafia" -> Lie -> He IS Mafia.
                //    Sohrab says "Kamran is Mafia" -> True (Since S is Cit).
                //    Reza says "Sohrab Lying" -> False (Reza is Cit, so he must tell truth). Contradiction.
                
                // If Sohrab Mafia: S(Lie->"Kamran not Mafia"), K(True->"I not Mafia"), R(True->"Sohrab Lie").
                //    Sohrab says "Kamran is Mafia" -> Lie (So Kamran is Cit).
                //    Kamran says "I not Mafia" -> True.
                //    Reza says "Sohrab Lying" -> True.
                //    MATCHES! Sohrab is the liar/Mafia.
                
                if (target === 'sohrab') {
                    fb.textContent = "âœ… Ø¯Ø±Ø³Øª Ø­Ø¯Ø³ Ø²Ø¯ÛŒØ¯! Ø³Ù‡Ø±Ø§Ø¨ Ù…Ø§ÙÛŒØ§ Ø§Ø³Øª.";
                    fb.style.color = "var(--clash-green)";
                } else {
                    fb.textContent = "âŒ Ø§Ø´ØªØ¨Ø§Ù‡! Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙÚ©Ø± Ú©Ù†ÛŒØ¯.";
                    fb.style.color = "var(--clash-red)";
                }
            });
        });

        // --- STRATEGY & MODALS ---
        document.getElementById('coordination-btn').onclick = () => navigateTo('strategy-screen');

        function openStrategyModal(title, text) {
            showModal(title, text, null);
            document.getElementById('modal-confirm-btn').onclick = closeModal;
            document.getElementById('modal-cancel-btn').classList.add('hidden');
        }

        // --- UI HANDLERS ---
        document.getElementById('start-game-btn').onclick = () => {
            document.getElementById('game-mode-panel-container').classList.remove('panel-hidden');
            document.getElementById('game-mode-panel-container').classList.add('panel-visible');
        };

        document.getElementById('close-game-mode-panel-btn').onclick = () => {
            document.getElementById('game-mode-panel-container').classList.remove('panel-visible');
            document.getElementById('game-mode-panel-container').classList.add('panel-hidden');
        };

        document.getElementById('developers-btn').onclick = () => {
            document.getElementById('developers-panel-container').classList.remove('panel-hidden');
            document.getElementById('developers-panel-container').classList.add('panel-visible');
        };

        document.getElementById('close-developers-panel-btn').onclick = () => {
            document.getElementById('developers-panel-container').classList.remove('panel-visible');
            document.getElementById('developers-panel-container').classList.add('panel-hidden');
        };

    </script>
</body>
</html>
